<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Ian MacLarty">
  <title>Amulet Manual - DEV 2016-14-01 09:16</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="content">
<header>
<h1 class="title">Amulet Manual - DEV 2016-14-01 09:16</h1>
<h2 class="author">Ian MacLarty</h2>
</header>
<nav id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#how-to-use-this-document">How to use this document</a></li>
<li><a href="#lua">Lua</a><ul>
<li><a href="#lua-primer">Lua primer</a></li>
<li><a href="#amulet-require-function">Amulet require function</a></li>
</ul></li>
<li><a href="#quickstart">Quickstart tutorial</a><ul>
<li><a href="#installing-amulet">Installing Amulet</a></li>
<li><a href="#running-a-script">Running a script</a></li>
<li><a href="#creating-a-window">Creating a window</a></li>
<li><a href="#rendering-text">Rendering text</a></li>
<li><a href="#transformation-nodes">Transformation nodes</a></li>
<li><a href="#actions">Actions</a></li>
<li><a href="#drawing-shapes">Drawing shapes</a></li>
<li><a href="#responding-to-key-presses">Responding to key presses</a></li>
<li><a href="#drawing-sprites">Drawing sprites</a></li>
<li><a href="#responding-to-mouse-clicks">Responding to mouse clicks</a></li>
<li><a href="#playing-audio">Playing audio</a></li>
</ul></li>
<li><a href="#maths">Maths</a><ul>
<li><a href="#vectors">Vectors</a><ul>
<li><a href="#constructing-vectors">Constructing vectors</a></li>
<li><a href="#accessing-vector-components">Accessing vector components</a></li>
<li><a href="#swizzle-fields">Swizzle fields</a></li>
<li><a href="#vector-update-syntax">Vector update syntax</a></li>
<li><a href="#vector-arithmetic">Vector arithmetic</a></li>
</ul></li>
<li><a href="#matrices">Matrices</a><ul>
<li><a href="#constructing-matrices">Constructing matrices</a></li>
<li><a href="#accessing-matrix-components">Accessing matrix components</a></li>
<li><a href="#matrix-arithmetic">Matrix arithmetic</a></li>
</ul></li>
<li><a href="#quaternions">Quaternions</a><ul>
<li><a href="#constructing-quaternions">Constructing quaternions</a></li>
<li><a href="#quaternion-fields">Quaternion fields</a></li>
<li><a href="#quaternion-operations">Quaternion operations</a></li>
</ul></li>
</ul></li>
<li><a href="#buffers-and-views">Buffers and views</a><ul>
<li><a href="#buffers">Buffers</a></li>
<li><a href="#views">Views</a></li>
</ul></li>
<li><a href="#scene-graphs">Scene graphs</a><ul>
<li><a href="#scene-graph-construction-syntax">Scene graph construction syntax</a></li>
<li><a href="#scene-node-common-methods">Scene node common methods</a><ul>
<li><a href="#node:tag">node:tag(tagname)</a></li>
<li><a href="#node:untag">node:untag(tagname)</a></li>
<li><a href="#node:all">node:all(tagname)</a></li>
<li><a href="#node:tagsearch">node(tagname)</a></li>
<li><a href="#node:action">node:action([id,] action)</a></li>
<li><a href="#node:late_action">node:late_action([id,] action)</a></li>
<li><a href="#node:cancel">node:cancel(id)</a></li>
<li><a href="#nodeappendchild">node:append(child)</a></li>
<li><a href="#nodeprependchild">node:prepend(child)</a></li>
<li><a href="#noderemovechild">node:remove(child)</a></li>
<li><a href="#noderemovetagname">node:remove(tagname)</a></li>
<li><a href="#noderemove_all">node:remove_all()</a></li>
<li><a href="#nodereplacechild-replacement">node:replace(child, replacement)</a></li>
<li><a href="#nodereplacetagname-replacement">node:replace(tagname, replacement)</a></li>
<li><a href="#nodechildn">node:child(n)</a></li>
<li><a href="#nodechild_pairs">node:child_pairs()</a></li>
</ul></li>
<li><a href="#scene-node-common-fields">Scene node common fields</a><ul>
<li><a href="#node.hidden">node.hidden</a></li>
<li><a href="#node.paused">node.paused</a></li>
<li><a href="#node.num_children">node.num_children</a></li>
<li><a href="#node.recursion_limit">node.recursion_limit</a></li>
</ul></li>
<li><a href="#core-scene-nodes">Core scene nodes</a><ul>
<li><a href="#am.groupchildren">am.group(children)</a></li>
<li><a href="#am.use_program">am.use_program(program)</a></li>
<li><a href="#am.bind">am.bind(bindings)</a></li>
<li><a href="#am.draw">am.draw(primitive [, elements] [, first [, count]])</a></li>
<li><a href="#am.translate">am.translate([uniform,] position)</a></li>
<li><a href="#am.scale">am.scale([uniform,] scaling)</a></li>
<li><a href="#am.rotate">am.rotate([uniform,] rotation)</a></li>
<li><a href="#am.blendmode">am.blend(mode)</a></li>
<li><a href="#am.cull_faceface">am.cull_face(face)</a></li>
<li><a href="#am.depth_test">am.depth_test(test [, mask])</a></li>
<li><a href="#am.viewport">am.viewport(x, y, width, height)</a></li>
<li><a href="#am.lookatuniform-eye-center-up">am.lookat([uniform,] eye, center, up)</a></li>
<li><a href="#am.cull_sphereuniforms...-radius-center">am.cull_sphere([uniforms...,] radius, center)</a></li>
<li><a href="#am.billboarduniform-preserve_scaling">am.billboard([uniform,] [preserve_scaling])</a></li>
<li><a href="#am.read_mat2uniform">am.read_mat2(uniform)</a></li>
<li><a href="#am.read_mat3uniform">am.read_mat3(uniform)</a></li>
<li><a href="#am.read_mat4uniform">am.read_mat4(uniform)</a></li>
<li><a href="#am.color_maskred-green-blue-alpha">am.color_mask(red, green, blue, alpha)</a></li>
</ul></li>
<li><a href="#derived-scene-nodes">Derived scene nodes</a><ul>
<li><a href="#am.text">am.text</a></li>
<li><a href="#am.sprite">am.sprite</a></li>
<li><a href="#am.rect">am.rect</a></li>
<li><a href="#am.circle">am.circle</a></li>
<li><a href="#am.particles2d">am.particles2d</a></li>
<li><a href="#am.postprocess">am.postprocess</a></li>
</ul></li>
<li><a href="#creating-custom-scene-nodes">Creating custom scene nodes</a></li>
</ul></li>
<li><a href="#graphics">Graphics</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#creating-a-window-1">Creating a window</a></li>
<li><a href="#shaders">Shaders</a></li>
<li><a href="#scene-graphs-1">Scene graphs</a></li>
<li><a href="#binding-shader-inputs">Binding shader inputs</a></li>
<li><a href="#drawing-primitives">Drawing primitives</a></li>
<li><a href="#transforms">Transforms</a></li>
<li><a href="#textures">Textures</a></li>
<li><a href="#framebuffers">Framebuffers</a></li>
<li><a href="#graphics-api-reference">Graphics API reference</a></li>
</ul></li>
<li><a href="#actions-1">Actions</a><ul>
<li><a href="#overview-1">Overview</a></li>
<li><a href="#creating-actions">Creating actions</a></li>
<li><a href="#cancelling-actions">Cancelling actions</a></li>
<li><a href="#composing-actions">Composing actions</a></li>
</ul></li>
<li><a href="#input">Input</a><ul>
<li><a href="#keyboard">Keyboard</a></li>
<li><a href="#mouse">Mouse</a></li>
</ul></li>
<li><a href="#audio">Audio</a><ul>
<li><a href="#audio-graphs">Audio graphs</a></li>
<li><a href="#playing-audio-1">Playing audio</a></li>
<li><a href="#analysing-audio">Analysing audio</a></li>
<li><a href="#audio-node-reference">Audio node reference</a></li>
</ul></li>
<li><a href="#project-settings">Project settings</a></li>
<li><a href="#api-reference">API reference</a><ul>
<li><a href="#maths-functions">Maths functions</a><ul>
<li><a href="#vec2...">vec2(...)</a></li>
<li><a href="#vec3...">vec3(...)</a></li>
<li><a href="#vec4...">vec4(...)</a></li>
<li><a href="#math.dot-vector1-vector2">math.dot (vector1, vector2)</a></li>
<li><a href="#math.crossvector1-vector2">math.cross(vector1, vector2)</a></li>
<li><a href="#math.normalizevector">math.normalize(vector)</a></li>
<li><a href="#math.lengthvector">math.length(vector)</a></li>
<li><a href="#math.distancevector1-vector2">math.distance(vector1, vector2)</a></li>
<li><a href="#mat2...">mat2(...)</a></li>
<li><a href="#mat3...">mat3(...)</a></li>
<li><a href="#mat4...">mat4(...)</a></li>
<li><a href="#math.inversematrix">math.inverse(matrix)</a></li>
<li><a href="#math.lookateye-center-up">math.lookat(eye, center, up)</a></li>
<li><a href="#math.perspectivefovy-aspect-near-far">math.perspective(fovy, aspect, near, far)</a></li>
<li><a href="#math.ortholeft-right-bottom-top-near-far">math.ortho(left, right, bottom, top [, near, far])</a></li>
<li><a href="#quat...">quat(...)</a></li>
<li><a href="#math.perlinpos-period">math.perlin(pos [, period])</a></li>
<li><a href="#math.simplexpos">math.simplex(pos)</a></li>
<li><a href="#math.mixfrom-top-t">math.mix(from, top, t)</a></li>
</ul></li>
<li><a href="#window-functions">Window functions</a><ul>
<li><a href="#window_func">am.window(settings)</a></li>
</ul></li>
<li><a href="#window-fields">Window fields</a><ul>
<li><a href="#window.left">window.left</a></li>
<li><a href="#window.right">window.right</a></li>
<li><a href="#window.bottom">window.bottom</a></li>
<li><a href="#window.top">window.top</a></li>
<li><a href="#window.width">window.width</a></li>
<li><a href="#window.height">window.height</a></li>
<li><a href="#window.pixel_width">window.pixel_width</a></li>
<li><a href="#window.pixel_height">window.pixel_height</a></li>
<li><a href="#window.mode">window.mode</a></li>
<li><a href="#window.clear_color">window.clear_color</a></li>
<li><a href="#window.letterbox">window.letterbox</a></li>
<li><a href="#window.lock_pointer">window.lock_pointer</a></li>
<li><a href="#window.scene">window.scene</a></li>
<li><a href="#window.projection">window.projection</a></li>
</ul></li>
<li><a href="#window-methods">Window methods</a><ul>
<li><a href="#windowclose">window:close()</a></li>
<li><a href="#key_down">window:key_down(key)</a></li>
<li><a href="#windowkeys_down">window:keys_down()</a></li>
<li><a href="#windowkey_pressedkey">window:key_pressed(key)</a></li>
<li><a href="#windowkey_releasedkey">window:key_released(key)</a></li>
<li><a href="#windowmouse_position">window:mouse_position()</a></li>
<li><a href="#windowmouse_norm_position">window:mouse_norm_position()</a></li>
<li><a href="#windowmouse_pixel_position">window:mouse_pixel_position()</a></li>
<li><a href="#windowmouse_delta">window:mouse_delta()</a></li>
<li><a href="#windowmouse_norm_delta">window:mouse_norm_delta()</a></li>
<li><a href="#windowmouse_pixel_delta">window:mouse_pixel_delta()</a></li>
<li><a href="#windowmouse_downbutton">window:mouse_down(button)</a></li>
<li><a href="#windowmouse_pressedbutton">window:mouse_pressed(button)</a></li>
<li><a href="#windowmouse_releasedbutton">window:mouse_released(button)</a></li>
<li><a href="#windowmouse_wheel">window:mouse_wheel()</a></li>
<li><a href="#windowmouse_wheel_delta">window:mouse_wheel_delta()</a></li>
<li><a href="#touches_began">window:touches_began()</a></li>
<li><a href="#windowtouches_ended">window:touches_ended()</a></li>
<li><a href="#windowactive_touches">window:active_touches()</a></li>
<li><a href="#windowtouch_begantouch">window:touch_began(touch)</a></li>
<li><a href="#windowtouch_endedtouch">window:touch_ended(touch)</a></li>
<li><a href="#windowtouch_positiontouch">window:touch_position(touch)</a></li>
<li><a href="#windowtouch_norm_positiontouch">window:touch_norm_position(touch)</a></li>
<li><a href="#windowtouch_pixel_positiontouch">window:touch_pixel_position(touch)</a></li>
<li><a href="#windowtouch_deltatouch">window:touch_delta(touch)</a></li>
<li><a href="#windowtouch_norm_deltatouch">window:touch_norm_delta(touch)</a></li>
<li><a href="#windowtouch_pixel_deltatouch">window:touch_pixel_delta(touch)</a></li>
<li><a href="#windowresized">window:resized()</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="introduction">Introduction</h1>
<p>Amulet is a Lua-based toolkit for experimenting with interactive graphics and audio. It provides a cross-platform API for drawing graphics, playing audio and responding to user input, and a command-line interpretter for running Amulet scripts.</p>
<p>It tries to be simple to use, but without making too many assumptions about how you want to use it.</p>
<p>Amulet currently runs on the following platforms:</p>
<ul>
<li>Windows 7+ (32 bit)</li>
<li>Mac OS X 10.6+ (64 bit)</li>
<li>Linux (32 and 64 bit)</li>
<li>HTML5</li>
<li>iOS (armv7 and arm64)</li>
</ul>
<p>Support for Android will be added at some point as well.</p>
<h1 id="how-to-use-this-document">How to use this document</h1>
<p>The <a href="#quickstart">quickstart tutorial</a> introduces basic concepts and walks you through drawing things on screen, playing audio and responding to user input.</p>
<p>It is suggested that new users go through the tutorial first. The rest of the document can then be used as a reference, dipping into sections as needed.</p>
<p>If you see a function argument with brackets around it in a function signature, then that argument is optional.</p>
<h1 id="lua">Lua</h1>
<p>Amulet code is written in <a href="http://www.lua.org">Lua</a>. The version of Lua used by default is Lua-5.1.</p>
<h2 id="lua-primer">Lua primer</h2>
<p>Here is a quick Lua syntax primer. For more detail please see the <a href="http://www.lua.org/manual/5.1/">Lua manual</a>.</p>
<p><strong>Comments:</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- This is a single line comment</span>

<span class="co">--[[ This is</span>
<span class="co">a multi-line</span>
<span class="co">comment ]]</span></code></pre></div>
<p><strong>Local variables (block scope):</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> x <span class="ot">=</span> <span class="dv">3.14</span> <span class="co">-- a number</span>
<span class="kw">local</span> str <span class="ot">=</span> <span class="st">&quot;a string&quot;</span>
<span class="kw">local</span> str2 <span class="ot">=</span> <span class="st">[[</span>
<span class="st">a</span>
<span class="st">multi-line</span>
<span class="st">string]]</span>
<span class="kw">local</span> bool <span class="ot">=</span> <span class="kw">true</span> <span class="co">-- a bool, can also be false</span>
<span class="kw">local</span> y <span class="ot">=</span> <span class="kw">nil</span> <span class="co">-- nil value</span></code></pre></div>
<p><strong>Global variables:</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">score <span class="ot">=</span> <span class="dv">0</span>
title <span class="ot">=</span> <span class="st">&quot;My Game&quot;</span></code></pre></div>
<p><strong>If-then-else:</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> x <span class="ot">=</span> <span class="dv">2</span>
<span class="kw">if</span> x <span class="ot">&gt;</span> <span class="dv">1</span> <span class="kw">then</span>
    <span class="fu">print</span><span class="ot">(</span><span class="st">&quot;x &gt; 1&quot;</span><span class="ot">)</span>
<span class="kw">elseif</span> x <span class="ot">&gt;</span> <span class="dv">0</span> <span class="kw">then</span>
    <span class="fu">print</span><span class="ot">(</span><span class="st">&quot;0 &lt; x &lt;= 0&quot;</span><span class="ot">)</span>
<span class="kw">else</span>
    <span class="fu">print</span><span class="ot">(</span><span class="st">&quot;x &lt;= 0&quot;</span><span class="ot">)</span>
<span class="kw">end</span></code></pre></div>
<p>The else part of an if-then-else executes only if the condition evaluates to <code>false</code> or <code>nil</code>.</p>
<p><strong>While loop:</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> n <span class="ot">=</span> <span class="dv">5</span>
<span class="kw">while</span> n <span class="ot">&gt;</span> <span class="dv">0</span> <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>n<span class="ot">)</span>
    n <span class="ot">=</span> n <span class="ot">-</span> <span class="dv">1</span>
<span class="kw">end</span>
<span class="co">-- prints 5 4 3 2 1</span></code></pre></div>
<p><strong>Repeat-until loop:</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> n <span class="ot">=</span> <span class="dv">0</span>
<span class="kw">repeat</span>
    n <span class="ot">=</span> n <span class="ot">+</span> <span class="dv">1</span>
    <span class="fu">print</span><span class="ot">(</span>n<span class="ot">)</span>
<span class="kw">until</span> n <span class="ot">==</span> <span class="dv">5</span>
<span class="co">-- prints 1 2 3 4 5</span></code></pre></div>
<p><strong>For loop:</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">for</span> i <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">5</span> <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>i<span class="ot">)</span>
<span class="kw">end</span>
<span class="co">-- prints 1 2 3 4 5</span>
<span class="kw">for</span> j <span class="ot">=</span> <span class="dv">10</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">2</span> <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>j<span class="ot">)</span>
<span class="kw">end</span>
<span class="co">-- prints 10 8 6 4 2</span></code></pre></div>
<p>You can break out of a loop using the <code>break</code> statement:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">for</span> j <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">10</span> <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>j<span class="ot">)</span>
    <span class="kw">if</span> j <span class="ot">==</span> <span class="dv">5</span> <span class="kw">then</span>
        <span class="kw">break</span>
    <span class="kw">end</span>
<span class="kw">end</span>
<span class="co">-- prints 1 2 3 4 5</span></code></pre></div>
<p><strong>Operators:</strong></p>
<p>The arithmetic operators are: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code> (exponent) and <code>%</code> (modulo).</p>
<p>The relational operators are: <code>==</code>, <code>~=</code> (not equal), <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code> and <code>&gt;=</code></p>
<p>The logical operators are: <code>and</code>, <code>or</code> and <code>not</code>.</p>
<p>The string concantenation operator is two dots (e.g. <code>&quot;abc&quot;..&quot;def&quot;</code>).</p>
<p><strong>Tables:</strong></p>
<p>Tables are the only data structure in Lua. They can be used as key-value maps or arrays.</p>
<p>Keys and values can be of any type except <code>nil</code>.</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> t <span class="ot">=</span> <span class="ot">{}</span> <span class="co">-- create empty table</span>
t<span class="ot">[</span><span class="st">&quot;score&quot;</span><span class="ot">]</span> <span class="ot">=</span> <span class="dv">10</span>
t<span class="ot">[</span><span class="dv">1</span><span class="ot">]</span> <span class="ot">=</span> <span class="st">&quot;foo&quot;</span>
t<span class="ot">[</span><span class="kw">true</span><span class="ot">]</span> <span class="ot">=</span> <span class="st">&quot;x&quot;</span>

<span class="co">-- this creates a table with 2 string keys:</span>
<span class="kw">local</span> t2 <span class="ot">=</span> <span class="ot">{</span>foo <span class="ot">=</span> <span class="st">&quot;bar&quot;</span><span class="ot">,</span> baz <span class="ot">=</span> <span class="dv">123</span><span class="ot">}</span></code></pre></div>
<p>Special syntax is provided for string keys:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> t <span class="ot">=</span> <span class="ot">{}</span>
t<span class="ot">.</span>score <span class="ot">=</span> <span class="dv">10</span>
<span class="fu">print</span><span class="ot">(</span>t<span class="ot">.</span>score<span class="ot">)</span></code></pre></div>
<p>The <code>#</code> operator returns the length of an array and array indices start at 1 by default.</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> arr <span class="ot">=</span> <span class="ot">{</span><span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">,</span> <span class="dv">5</span><span class="ot">}</span>
<span class="kw">for</span> i <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span> <span class="ot">#</span>arr <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>arr<span class="ot">[</span>i<span class="ot">])</span>
<span class="kw">end</span>
<span class="co">-- prints 3, 4, 5</span>
<span class="fu">table.insert</span><span class="ot">(</span>arr<span class="ot">,</span> <span class="dv">6</span><span class="ot">)</span> <span class="co">-- appends 6 to end of arr</span>
<span class="fu">table.remove</span><span class="ot">(</span>arr<span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span> <span class="co">-- removes the first element of arr</span>
<span class="co">-- arr is now {4, 5, 6}</span></code></pre></div>
<p>Setting a key's value to <code>nil</code> removes the key and indexing a missing key returns <code>nil</code>.</p>
<p>You can iterate over all key/value pairs using the <code>pairs</code> function. Note that the order is not preserved.</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> t <span class="ot">=</span> <span class="ot">{</span>a <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span> b <span class="ot">=</span> <span class="dv">2</span><span class="ot">,</span> c <span class="ot">=</span> <span class="dv">3</span><span class="ot">}</span>
<span class="kw">for</span> k<span class="ot">,</span> v <span class="kw">in</span> <span class="fu">pairs</span><span class="ot">(</span>t<span class="ot">)</span> <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>k<span class="ot">..</span><span class="st">&quot;:&quot;</span><span class="ot">..</span>v<span class="ot">)</span>
<span class="kw">end</span>
<span class="co">-- prints a:1 c:3 b:2</span></code></pre></div>
<p>To iterate over an array table, keeping the order, use <code>ipairs</code>:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> arr <span class="ot">=</span> <span class="ot">{</span><span class="st">&quot;a&quot;</span><span class="ot">,</span> <span class="st">&quot;b&quot;</span><span class="ot">,</span> <span class="st">&quot;c&quot;</span><span class="ot">}</span>
<span class="kw">for</span> k<span class="ot">,</span> v <span class="kw">in</span> <span class="fu">ipairs</span><span class="ot">(</span>arr<span class="ot">)</span> <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>k<span class="ot">..</span><span class="st">&quot;:&quot;</span><span class="ot">..</span>v<span class="ot">)</span>
<span class="kw">end</span>
<span class="co">-- prints 1:a 2:b 3:c</span></code></pre></div>
<p><strong>Functions:</strong></p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">function</span> factorial<span class="ot">(</span>n<span class="ot">)</span>
    <span class="kw">if</span> n <span class="ot">&lt;=</span> <span class="dv">1</span> <span class="kw">then</span>
        <span class="kw">return</span> <span class="dv">1</span>
    <span class="kw">else</span>
        <span class="kw">return</span> n <span class="ot">*</span> factorial<span class="ot">(</span>n<span class="ot">-</span><span class="dv">1</span><span class="ot">)</span>
    <span class="kw">end</span>
<span class="kw">end</span>
<span class="fu">print</span><span class="ot">(</span>factorial<span class="ot">(</span><span class="dv">3</span><span class="ot">))</span> <span class="co">-- prints 6</span></code></pre></div>
<p>Functions are values in Lua so they can be assigned to variables:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> add <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span>a<span class="ot">,</span> b<span class="ot">)</span>
    <span class="kw">return</span> a <span class="ot">+</span> b
<span class="kw">end</span>
<span class="fu">print</span><span class="ot">(</span>add<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">))</span> <span class="co">-- prints 3</span></code></pre></div>
<p>Special syntax is provided for adding functions to tables:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> t <span class="ot">=</span> <span class="ot">{</span>x <span class="ot">=</span> <span class="dv">3</span><span class="ot">}</span>
<span class="kw">function</span> t<span class="ot">.</span>say_hello<span class="ot">()</span>
    <span class="fu">print</span><span class="ot">(</span><span class="st">&quot;hello&quot;</span><span class="ot">)</span>
<span class="kw">end</span>
<span class="kw">function</span> t:print_x<span class="ot">()</span>
    <span class="fu">print</span><span class="ot">(</span>self<span class="ot">.</span>x<span class="ot">)</span>
<span class="kw">end</span>
t<span class="ot">.</span>say_hello<span class="ot">()</span> <span class="co">-- prints hello</span>
t:print_x<span class="ot">()</span>   <span class="co">-- prints 3</span>
t<span class="ot">.</span>x <span class="ot">=</span> <span class="dv">4</span>
t:print_x<span class="ot">()</span>   <span class="co">-- prints 4</span></code></pre></div>
<p>If a function call has only a single string or table argument, the parentheses can be omitted.</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span>
<span class="kw">function</span> append_z<span class="ot">(</span>str<span class="ot">)</span>
    <span class="kw">return</span> str<span class="ot">..</span><span class="st">&quot;z&quot;</span>
<span class="kw">end</span>
<span class="fu">print</span><span class="ot">(</span>append_z<span class="st">&quot;xy&quot;</span><span class="ot">)</span> <span class="co">-- prints xyz</span>

<span class="kw">local</span>
<span class="kw">function</span> sum<span class="ot">(</span>values<span class="ot">)</span>
    <span class="kw">local</span> total <span class="ot">=</span> <span class="dv">0</span>
    <span class="kw">for</span> _<span class="ot">,</span> value <span class="kw">in</span> <span class="fu">ipairs</span><span class="ot">(</span>values<span class="ot">)</span> <span class="kw">do</span>
        total <span class="ot">=</span> total <span class="ot">+</span> value
    <span class="kw">end</span>
    <span class="kw">return</span> total
<span class="kw">end</span>
<span class="fu">print</span><span class="ot">(</span>sum<span class="ot">{</span><span class="dv">3</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">6</span><span class="ot">})</span> <span class="co">-- prints 10</span></code></pre></div>
<h2 id="amulet-require-function">Amulet require function</h2>
<p>The <code>require</code> function in Amulet is slightly different from the default one. The default Lua package loaders have been removed and replaced with a custom loader. The loader passes a new empty table into each module it loads. All exported functions can be added to this table, instead of creating a new table. If no other value is returned by the module, the passed in table will be used as the return value for <code>require</code>.</p>
<p>The passed in export table can be accessed via the <code>...</code> expression. Here's a short example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> mymodule <span class="ot">=</span> <span class="ot">...</span>

mymodule<span class="ot">.</span>message <span class="ot">=</span> <span class="st">&quot;hello&quot;</span>

<span class="kw">function</span> mymodule<span class="ot">.</span>print_message<span class="ot">()</span>
    <span class="fu">print</span><span class="ot">(</span>mymodule<span class="ot">.</span>message<span class="ot">)</span>
<span class="kw">end</span></code></pre></div>
<p>If this module is in the file <code>mymodule.lua</code>, then it can be imported like so:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> mymodule <span class="ot">=</span> <span class="fu">require</span> <span class="st">&quot;mymodule&quot;</span>

mymodule<span class="ot">.</span>print_message<span class="ot">()</span> <span class="co">-- prints hello</span></code></pre></div>
<p>This scheme allows cyclic module imports, e.g. module A requires module B which in turn requires module A. Amulet will detect the recursion and return A's (incomplete) export table in B. Then when A has finished initializing, all its functions will be available in B. This does mean that B can't call any of A's functions while its initializing, but after initialization all of A's functions will be available.</p>
<p>Of course you can still return your own values from modules and they will be returned by <code>require</code> as with the default Lua <code>require</code> function.</p>
<h1 id="quickstart">Quickstart tutorial</h1>
<h2 id="installing-amulet">Installing Amulet</h2>
<p><strong>Windows:</strong></p>
<p><a href="http://www.amulet.xyz">Download</a> the Windows installer and run it. Or, if you prefer, download the Windows zip archive, extract it to a directory of your choice and add that directory to your PATH.</p>
<p><strong>Mac:</strong></p>
<p><a href="http://www.amulet.xyz">Download</a> the OSX pkg file and run it. Or, if you prefer, download the OSX zip archive, extract it to a directory of your choice and add that directory to your PATH.</p>
<p><strong>Linux:</strong></p>
<p><a href="http://www.amulet.xyz">Download</a> and extract the Linux zip archive to a directory of your choice. Then add the directory to your PATH. The <code>amulet</code> executable is for x86_64. If you're running a 32 bit system, rename the file <code>amulet.i686</code> to <code>amulet</code>.</p>
<h2 id="running-a-script">Running a script</h2>
<p>Create a text file called <code>main.lua</code> containing the following:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="fu">log</span><span class="ot">(</span><span class="st">&quot;It works!&quot;</span><span class="ot">)</span></code></pre></div>
<p>Open a terminal (&quot;command prompt&quot; on Windows) and change to the directory containing the file. Then type &quot;<code>amulet main.lua</code>&quot;:</p>
<pre class="console"><code>&gt; amulet main.lua
main.lua:1: It works!</code></pre>
<p>If you see the text &quot;<code>main.lua:1: It works!</code>&quot;, Amulet is installed and working.</p>
<h2 id="creating-a-window">Creating a window</h2>
<p>Type the following into <code>main.lua</code>:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{</span>
    title <span class="ot">=</span> <span class="st">&quot;Hi&quot;</span><span class="ot">,</span>
    width <span class="ot">=</span> <span class="dv">400</span><span class="ot">,</span>
    height <span class="ot">=</span> <span class="dv">300</span><span class="ot">,</span>
    clear_color <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0.5</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
<span class="ot">}</span></code></pre></div>
<p>and run it as before. This time a bright pink window should appear.</p>
<h2 id="rendering-text">Rendering text</h2>
<p>Add the following line to main.lua after the line that creates the window:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene <span class="ot">=</span> am<span class="ot">.</span>text<span class="ot">(</span><span class="st">&quot;Hello!&quot;</span><span class="ot">)</span></code></pre></div>
<p>This assigns a <em>scene graph</em> to the window. The scene has a single text node. The window will render its scene graph each frame.</p>
<div class="figure">
<img src="images/hello1.png" alt="" />

</div>
<h2 id="transformation-nodes">Transformation nodes</h2>
<p>Change the previous line to:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene <span class="ot">=</span> 
    am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">100</span><span class="ot">)</span>
    <span class="ot">^</span> am<span class="ot">.</span>scale<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>
    <span class="ot">^</span> am<span class="ot">.</span>rotate<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">90</span><span class="ot">))</span>
    <span class="ot">^</span> am<span class="ot">.</span>text<span class="ot">(</span><span class="st">&quot;Hello!&quot;</span><span class="ot">)</span></code></pre></div>
<p>This adds translate, scale and rotate nodes as parents of the text node. These nodes transform the position, size and rotation of all their children. The resulting scene graph looks like this:</p>
<div class="figure">
<img src="graphs/scene1.png" alt="" />

</div>
<p>The translate node moves its descendents to the right 150 and up 100 (by convention the y axis increases in upward direction). The scale node doubles its descendents's size and the rotate node rotates its descendents by 90 degrees (<code>math.rad</code> converts degrees to radians). Finally the text node renders some text to the screen.</p>
<p>When you run the program you should see something like this:</p>
<div class="figure">
<img src="images/hello2.png" alt="" />

</div>
<h2 id="actions">Actions</h2>
<p>Add the following to the end of main.lua:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene:action<span class="ot">(</span><span class="kw">function</span><span class="ot">(</span>scene<span class="ot">)</span>
    scene<span class="st">&quot;rotate&quot;</span><span class="ot">.</span>angle <span class="ot">=</span> am<span class="ot">.</span>frame_time <span class="ot">*</span> <span class="dv">4</span>
<span class="kw">end</span><span class="ot">)</span></code></pre></div>
<p>When you run it the text will spin.</p>
<p>This code adds an <em>action</em> to the scene, which is a function that's run once per frame. Actions can be added to any scene node. In this case we've added it to the node <code>win.scene</code>, which is the top <code>translate</code> node of our scene graph. The node to which an action is attached is passed as an argument to the action function.</p>
<p>The line:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">scene<span class="st">&quot;rotate&quot;</span><span class="ot">.</span>angle <span class="ot">=</span> am<span class="ot">.</span>frame_time <span class="ot">*</span> <span class="dv">4</span></code></pre></div>
<p>first finds a node with the <em>tag</em> <code>&quot;rotate&quot;</code> in the scene graph. By default nodes have tags that correspond to their names, so this returns the rotate node. You can also add your own tags to nodes using the <code>tag</code> method which we'll discuss in more detail in the next section.</p>
<p>Then we set the <code>angle</code> property of the rotate node to the current frame time (the time at the beginning of the frame, in seconds) times 4.</p>
<p>Since this code is run each frame, it causes the text to spin.</p>
<p>Here is the complete code listing:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{</span>
    title <span class="ot">=</span> <span class="st">&quot;Hi&quot;</span><span class="ot">,</span>
    width <span class="ot">=</span> <span class="dv">400</span><span class="ot">,</span>
    height <span class="ot">=</span> <span class="dv">300</span><span class="ot">,</span>
    clear_color <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0.5</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
<span class="ot">}</span>
win<span class="ot">.</span>scene <span class="ot">=</span> 
    am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">100</span><span class="ot">)</span>
    <span class="ot">^</span> am<span class="ot">.</span>scale<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>
    <span class="ot">^</span> am<span class="ot">.</span>rotate<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">90</span><span class="ot">))</span>
    <span class="ot">^</span> am<span class="ot">.</span>text<span class="ot">(</span><span class="st">&quot;Hello!&quot;</span><span class="ot">)</span>
win<span class="ot">.</span>scene:action<span class="ot">(</span><span class="kw">function</span><span class="ot">(</span>scene<span class="ot">)</span>
    scene<span class="st">&quot;rotate&quot;</span><span class="ot">.</span>angle <span class="ot">=</span> am<span class="ot">.</span>frame_time <span class="ot">*</span> <span class="dv">4</span>
<span class="kw">end</span><span class="ot">)</span></code></pre></div>
<h2 id="drawing-shapes">Drawing shapes</h2>
<p>Here is a simple program that draws 2 red circles on either side of a yellow square on a blue background.</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> red <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
<span class="kw">local</span> blue <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
<span class="kw">local</span> yellow <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>

<span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{</span>
    title <span class="ot">=</span> <span class="st">&quot;Hi&quot;</span><span class="ot">,</span>
    width <span class="ot">=</span> <span class="dv">400</span><span class="ot">,</span>
    height <span class="ot">=</span> <span class="dv">300</span><span class="ot">,</span>
    clear_color <span class="ot">=</span> blue<span class="ot">,</span>
<span class="ot">}</span>

win<span class="ot">.</span>scene <span class="ot">=</span>
    am<span class="ot">.</span>group<span class="ot">()</span>
    <span class="ot">^</span> <span class="ot">{</span>
        am<span class="ot">.</span>translate<span class="ot">(-</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>
        <span class="ot">^</span> am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">)</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>
        <span class="ot">^</span> am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">)</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">25</span><span class="ot">)</span>
        <span class="ot">^</span> am<span class="ot">.</span>rect<span class="ot">(-</span><span class="dv">50</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> yellow<span class="ot">)</span>
    <span class="ot">}</span></code></pre></div>
<div class="figure">
<img src="images/shapes.png" alt="" />

</div>
<p>This time, we've created variables for the different colours we'll need. In Amulet colours are 4-dimensional vectors. Each component of the vector represents the red, green, blue and alpha intensity of the colour and ranges from 0 to 1.</p>
<p>The scene graph has a <code>group</code> node at the top. <code>group</code> nodes don't have any effect on the rendering and are only used to group other nodes together. The group node has 3 children, each of which is a <code>translate</code> node with a shape child. The scene graph looks like this:</p>
<div class="figure">
<img src="graphs/scene2.png" alt="" />

</div>
<p>Instead of building the scene graph using the <code>^</code> operator as we've done above, we can also do it step-by-step using the <code>append</code> method, which adds a node to the child list of another node:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> circle1_node <span class="ot">=</span> am<span class="ot">.</span>translate<span class="ot">(-</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>
circle1_node:append<span class="ot">(</span>am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">))</span>

<span class="kw">local</span> circle2_node <span class="ot">=</span> am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>
circle2_node:append<span class="ot">(</span>am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">))</span>

<span class="kw">local</span> rect_node <span class="ot">=</span> am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>
rect_node:append<span class="ot">(</span>am<span class="ot">.</span>rect<span class="ot">(-</span><span class="dv">50</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> yellow<span class="ot">))</span>

<span class="kw">local</span> group_node <span class="ot">=</span> am<span class="ot">.</span>group<span class="ot">()</span>
group_node:append<span class="ot">(</span>circle1_node<span class="ot">)</span>
group_node:append<span class="ot">(</span>circle2_node<span class="ot">)</span>
group_node:append<span class="ot">(</span>rect_node<span class="ot">)</span>

win<span class="ot">.</span>scene <span class="ot">=</span> group_node</code></pre></div>
<p>This results in the exact same scene graph.</p>
<h2 id="responding-to-key-presses">Responding to key presses</h2>
<p>Let's change the above program so that the left circle only appears while the A key is down and the right circle only appears while the B key is down.</p>
<p>In order to distinguish the two circles in the scene graph we'll give them different tags.</p>
<p>Change the scene setup code to look like this:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene <span class="ot">=</span>
    am<span class="ot">.</span>group<span class="ot">()</span>
    <span class="ot">^</span> <span class="ot">{</span>
        am<span class="ot">.</span>translate<span class="ot">(-</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;left_eye&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">)</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;right_eye&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">)</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">25</span><span class="ot">)</span>
        <span class="ot">^</span> am<span class="ot">.</span>rect<span class="ot">(-</span><span class="dv">50</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> yellow<span class="ot">)</span>
    <span class="ot">}</span></code></pre></div>
<p>The only difference is the addition of <code>:tag&quot;left_eye&quot;</code> and <code>:tag&quot;right_eye&quot;</code>. These add the tag <code>&quot;left_eye&quot;</code> to the translate node which is the parent of the left circle node and <code>&quot;right_eye&quot;</code> to the right translate node which is the parent of the right circle node.</p>
<p>Now add the following action:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene:action<span class="ot">(</span><span class="kw">function</span><span class="ot">(</span>scene<span class="ot">)</span>
    scene<span class="st">&quot;left_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">not</span> win:key_down<span class="st">&quot;a&quot;</span>
    scene<span class="st">&quot;right_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">not</span> win:key_down<span class="st">&quot;b&quot;</span>
<span class="kw">end</span><span class="ot">)</span></code></pre></div>
<p>The <code>hidden</code> field of a node determines whether it is drawn or not. Each frame we set the <code>hidden</code> field of the left and right translate nodes to whether the A or B keys are being pressed. <code>win:key_down(X)</code> returns true if key <code>X</code> was being held down at the start of the frame.</p>
<p>You may notice that the three shapes appear briefly when the window is first shown and then disappear immediately. This is because actions only start running in the next frame, so the shapes are only hidden on the second frame. To fix this we can add the following lines either before or after we add the action (it doesn't matter where):</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene<span class="st">&quot;left_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">true</span>
win<span class="ot">.</span>scene<span class="st">&quot;right_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">true</span></code></pre></div>
<p>Here is the complete code listing:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> red <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
<span class="kw">local</span> blue <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
<span class="kw">local</span> yellow <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>

<span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{</span>
    title <span class="ot">=</span> <span class="st">&quot;Hi&quot;</span><span class="ot">,</span>
    width <span class="ot">=</span> <span class="dv">400</span><span class="ot">,</span>
    height <span class="ot">=</span> <span class="dv">300</span><span class="ot">,</span>
    clear_color <span class="ot">=</span> blue<span class="ot">,</span>
<span class="ot">}</span>

win<span class="ot">.</span>scene <span class="ot">=</span>
    am<span class="ot">.</span>group<span class="ot">()</span>
    <span class="ot">^</span> <span class="ot">{</span>
        am<span class="ot">.</span>translate<span class="ot">(-</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;left_eye&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">)</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">150</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;right_eye&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>circle<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> <span class="dv">50</span><span class="ot">,</span> red<span class="ot">)</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">25</span><span class="ot">)</span>
        <span class="ot">^</span> am<span class="ot">.</span>rect<span class="ot">(-</span><span class="dv">50</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> <span class="dv">50</span><span class="ot">,</span> yellow<span class="ot">)</span>
    <span class="ot">}</span>

win<span class="ot">.</span>scene:action<span class="ot">(</span><span class="kw">function</span><span class="ot">(</span>scene<span class="ot">)</span>
    scene<span class="st">&quot;left_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">not</span> win:key_down<span class="st">&quot;a&quot;</span>
    scene<span class="st">&quot;right_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">not</span> win:key_down<span class="st">&quot;b&quot;</span>
<span class="kw">end</span><span class="ot">)</span>

win<span class="ot">.</span>scene<span class="st">&quot;left_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">true</span>
win<span class="ot">.</span>scene<span class="st">&quot;right_eye&quot;</span><span class="ot">.</span>hidden <span class="ot">=</span> <span class="kw">true</span></code></pre></div>
<h2 id="drawing-sprites">Drawing sprites</h2>
<p>Sprites can be drawn using sprite nodes. To create a sprite node, pass the name of a .png or .jpg file to the <code>am.sprite()</code> function and add it to your scene graph.</p>
<p>Let's create a beach scene using the following two images:</p>
<div class="figure">
<img src="images/beach.jpg" alt="beach.jpg" />
<p class="caption">beach.jpg</p>
</div>
<div class="figure">
<img src="images/ball.png" alt="ball.png" />
<p class="caption">ball.png</p>
</div>
<p>Download these images and copy them to the same directory as your <code>main.lua</code> file. Then copy the following into <code>main.lua</code>:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{</span>
    title <span class="ot">=</span> <span class="st">&quot;Beach&quot;</span><span class="ot">,</span>
    width <span class="ot">=</span> <span class="dv">400</span><span class="ot">,</span>
    height <span class="ot">=</span> <span class="dv">300</span><span class="ot">,</span>
<span class="ot">}</span>

win<span class="ot">.</span>scene <span class="ot">=</span> 
    am<span class="ot">.</span>group<span class="ot">()</span>
    <span class="ot">^</span> <span class="ot">{</span>
        am<span class="ot">.</span>sprite<span class="st">&quot;beach.jpg&quot;</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">60</span><span class="ot">)</span>
        <span class="ot">^</span> am<span class="ot">.</span>sprite<span class="st">&quot;ball.png&quot;</span>
    <span class="ot">}</span></code></pre></div>
<p>Run the program and you should get something like this:</p>
<div class="figure">
<img src="images/beach1.png" alt="" />

</div>
<p>The children of any scene node are always drawn in order, so first the beach.jpg sprite node is drawn and then the ball.png sprite, with it's corresponding translation, is drawn. This ensures the ball is visible on the beach. If we draw the beach second it would obscure the ball.</p>
<h2 id="responding-to-mouse-clicks">Responding to mouse clicks</h2>
<p>Let's make the ball bounce when we click it. We'll add a rotate node so we can make the ball spin when it's in the air. We'll also tag the ball's translate and rotate nodes so we can easily access them:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene <span class="ot">=</span> 
    am<span class="ot">.</span>group<span class="ot">()</span>
    <span class="ot">^</span> <span class="ot">{</span>
        am<span class="ot">.</span>sprite<span class="st">&quot;beach.jpg&quot;</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">60</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;ballt&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>rotate<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;ballr&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>sprite<span class="st">&quot;ball.png&quot;</span>
    <span class="ot">}</span></code></pre></div>
<p>Now add an action to animate the ball when it's clicked:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">-- ball state variables:</span>
<span class="kw">local</span> ball_pos <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">60</span><span class="ot">)</span>
<span class="kw">local</span> ball_angle <span class="ot">=</span> <span class="dv">0</span>
<span class="kw">local</span> velocity <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span>
<span class="kw">local</span> spin <span class="ot">=</span> <span class="dv">0</span>

<span class="co">-- constants:</span>
<span class="kw">local</span> min_pos <span class="ot">=</span> vec2<span class="ot">(-</span><span class="dv">180</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">60</span><span class="ot">)</span>
<span class="kw">local</span> max_pos <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">180</span><span class="ot">,</span> <span class="dv">500</span><span class="ot">)</span>
<span class="co">-- min and max impulse velocity:</span>
<span class="kw">local</span> min_v <span class="ot">=</span> vec2<span class="ot">(-</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">150</span><span class="ot">)</span>
<span class="kw">local</span> max_v <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">300</span><span class="ot">)</span>
<span class="kw">local</span> gravity <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">500</span><span class="ot">)</span>

win<span class="ot">.</span>scene:action<span class="ot">(</span><span class="kw">function</span><span class="ot">(</span>scene<span class="ot">)</span>
    <span class="co">-- check if the left mouse button was pressed</span>
    <span class="kw">if</span> win:mouse_pressed<span class="st">&quot;left&quot;</span> <span class="kw">then</span>
        <span class="kw">local</span> mouse_pos <span class="ot">=</span> win:mouse_position<span class="ot">()</span>
        <span class="co">-- check if the mouse click is on the ball</span>
        <span class="kw">if</span> math<span class="ot">.</span>distance<span class="ot">(</span>mouse_pos<span class="ot">,</span> ball_pos<span class="ot">)</span> <span class="ot">&lt;</span> <span class="dv">50</span> <span class="kw">then</span>
            <span class="co">-- compute a velocity based on click position</span>
            <span class="kw">local</span> dir <span class="ot">=</span> math<span class="ot">.</span>normalize<span class="ot">(</span>ball_pos <span class="ot">-</span> mouse_pos<span class="ot">)</span>
            velocity <span class="ot">=</span> dir <span class="ot">*</span> <span class="dv">300</span>
            velocity <span class="ot">=</span> math<span class="ot">.</span>clamp<span class="ot">(</span>velocity<span class="ot">,</span> min_v<span class="ot">,</span> max_v<span class="ot">)</span>
            <span class="co">-- set a random spin</span>
            spin <span class="ot">=</span> <span class="fu">math.random</span><span class="ot">()</span> <span class="ot">*</span> <span class="dv">4</span> <span class="ot">-</span> <span class="dv">2</span>
        <span class="kw">end</span>
    <span class="kw">end</span>

    <span class="co">-- update the ball position</span>
    ball_pos <span class="ot">=</span> ball_pos <span class="ot">+</span> velocity <span class="ot">*</span> am<span class="ot">.</span>delta_time

    <span class="co">-- if the ball is on the ground, set the</span>
    <span class="co">-- velocity and spin to zero.</span>
    <span class="kw">if</span> ball_pos<span class="ot">.</span>y <span class="ot">&lt;=</span> <span class="ot">-</span><span class="dv">60</span> <span class="kw">then</span>
        velocity <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span>
        spin <span class="ot">=</span> <span class="dv">0</span>
    <span class="kw">end</span>

    <span class="co">-- clamp the ball position so it doesn&#39;t dissapear</span>
    <span class="co">-- off the edge of the screen</span>
    ball_pos <span class="ot">=</span> math<span class="ot">.</span>clamp<span class="ot">(</span>ball_pos<span class="ot">,</span> min_pos<span class="ot">,</span> max_pos<span class="ot">)</span>

    <span class="co">-- update the ball angle</span>
    ball_angle <span class="ot">=</span> ball_angle <span class="ot">+</span> spin <span class="ot">*</span> am<span class="ot">.</span>delta_time

    <span class="co">-- update the ball translate and rotate nodes</span>
    scene<span class="st">&quot;ballt&quot;</span><span class="ot">.</span>position2d <span class="ot">=</span> ball_pos
    scene<span class="st">&quot;ballr&quot;</span><span class="ot">.</span>angle <span class="ot">=</span> ball_angle

    <span class="co">-- apply gravity to the velocity</span>
    velocity <span class="ot">=</span> velocity <span class="ot">+</span> gravity <span class="ot">*</span> am<span class="ot">.</span>delta_time
<span class="kw">end</span><span class="ot">)</span></code></pre></div>
<p>First we create some variables to keep track of the ball's state. We need to track its position, angle, velocity and spin (angular velocity). The <code>ball_pos</code> and <code>velocity</code> variables are 2 dimensional vectors, since we want to track position and velocity along both the x and y axes. We could have made separate variables for the x and y components, but using a <code>vec2</code> is more concise. Note that if the values of the x and y components of the vector are the same, we only need to give the value once, so we just need to write <code>vec2(0)</code> when initializing the velocity instead of <code>vec2(0, 0)</code>.</p>
<p>We also create some constants that we'll need. We define the minimum and maximum positions of the ball (<code>min_pos</code>, <code>max_pos</code>). We also define the minimum and maximum impulse velocity to apply to the ball when it's clicked (<code>min_v</code>, <code>max_v</code>). And finally we create a constant for gravity.</p>
<p>Next comes the action itself. The comments in the body of the action should help you work out what's going on, but here are some things to node:</p>
<ul>
<li><code>win:mouse_pressed(button)</code> can be used to check whether a mouse button was pressed in the last frame. <code>button</code> can be <code>&quot;left&quot;</code>, <code>&quot;right&quot;</code> or <code>&quot;middle&quot;</code>.</li>
<li><code>win:mouse_position()</code> returns the current mouse position as a <code>vec2</code> value.</li>
<li><code>math.distance</code> computes the distance between two vectors.</li>
<li><code>math.clamp</code> clamps a value between two other values. It works with both numbers and vectors.</li>
<li><code>math.random()</code> returns a random number between 0 and 1.</li>
<li><code>am.delta_time</code> is the time since the last frame.</li>
<li>Vector values can be added, subtracted and multiplied just like numbers. You can also combine numbers and vectors, for example when we multiply <code>gravity</code> by <code>am.delta_time</code>. The result of <code>vec2(x, y) * c</code> is <code>vec2(x*c, y*c)</code>.</li>
</ul>
<h2 id="playing-audio">Playing audio</h2>
<p>To play a sound, attach a <code>play</code> action to a scene node in the current scene. For example to play a sound file <code>bounce.ogg</code> we could do the following:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">scene:action<span class="ot">(</span>am<span class="ot">.</span>play<span class="ot">(</span><span class="st">&quot;bounce.ogg&quot;</span><span class="ot">))</span></code></pre></div>
<p>The file <code>bounce.ogg</code> must exist in the same directory as the script.</p>
<p>To have a sound loop, pass in a second argument of <code>true</code>, like so:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">win<span class="ot">.</span>scene:action<span class="ot">(</span>am<span class="ot">.</span>play<span class="ot">(</span><span class="st">&quot;ocean.ogg&quot;</span><span class="ot">,</span> <span class="kw">true</span><span class="ot">))</span></code></pre></div>
<p>Note that Amulet only reads Ogg Vorbis audio files.</p>
<p>Here are some audio files you can try out with the beach ball game we made previously:</p>
<ul>
<li><a href="sounds/bounce.ogg"><code>sounds/bounce.ogg</code></a></li>
<li><a href="sounds/ocean.ogg"><code>sounds/ocean.ogg</code></a></li>
<li><a href="sounds/land.ogg"><code>sounds/land.ogg</code></a></li>
</ul>
<p>And here is the complete code listing for the beach ball game with sounds included. Note that we need an extra variable <code>on_ground</code> to keep track of whether the ball was on the ground, so we don't play the landing sound every frame.</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{</span>
    title <span class="ot">=</span> <span class="st">&quot;Beach&quot;</span><span class="ot">,</span>
    width <span class="ot">=</span> <span class="dv">400</span><span class="ot">,</span>
    height <span class="ot">=</span> <span class="dv">300</span><span class="ot">,</span>
<span class="ot">}</span>

win<span class="ot">.</span>scene <span class="ot">=</span> 
    am<span class="ot">.</span>group<span class="ot">()</span>
    <span class="ot">^</span> <span class="ot">{</span>
        am<span class="ot">.</span>sprite<span class="st">&quot;beach.jpg&quot;</span>
        <span class="ot">,</span>
        am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">60</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;ballt&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>rotate<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span>:<span class="fu">tag</span><span class="st">&quot;ballr&quot;</span>
        <span class="ot">^</span> am<span class="ot">.</span>sprite<span class="st">&quot;ball.png&quot;</span>
    <span class="ot">}</span>

<span class="kw">local</span> ball_pos <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">60</span><span class="ot">)</span>
<span class="kw">local</span> ball_angle <span class="ot">=</span> <span class="dv">0</span>
<span class="kw">local</span> velocity <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span>
<span class="kw">local</span> spin <span class="ot">=</span> <span class="dv">0</span>
<span class="kw">local</span> min_pos <span class="ot">=</span> vec2<span class="ot">(-</span><span class="dv">180</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">60</span><span class="ot">)</span>
<span class="kw">local</span> max_pos <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">180</span><span class="ot">,</span> <span class="dv">500</span><span class="ot">)</span>
<span class="kw">local</span> min_v <span class="ot">=</span> vec2<span class="ot">(-</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">150</span><span class="ot">)</span>
<span class="kw">local</span> max_v <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">50</span><span class="ot">,</span> <span class="dv">300</span><span class="ot">)</span>
<span class="kw">local</span> gravity <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">500</span><span class="ot">)</span>
<span class="kw">local</span> on_ground <span class="ot">=</span> <span class="kw">true</span>

win<span class="ot">.</span>scene:action<span class="ot">(</span><span class="kw">function</span><span class="ot">(</span>scene<span class="ot">)</span>
    <span class="co">-- check if the left mouse button was pressed</span>
    <span class="kw">if</span> win:mouse_pressed<span class="st">&quot;left&quot;</span> <span class="kw">then</span>
        <span class="kw">local</span> mouse_pos <span class="ot">=</span> win:mouse_position<span class="ot">()</span>
        <span class="co">-- check if the mouse click is on the ball</span>
        <span class="kw">if</span> math<span class="ot">.</span>distance<span class="ot">(</span>mouse_pos<span class="ot">,</span> ball_pos<span class="ot">)</span> <span class="ot">&lt;</span> <span class="dv">50</span> <span class="kw">then</span>
            <span class="co">-- compute a velocity based on click position</span>
            <span class="kw">local</span> dir <span class="ot">=</span> math<span class="ot">.</span>normalize<span class="ot">(</span>ball_pos <span class="ot">-</span> mouse_pos<span class="ot">)</span>
            velocity <span class="ot">=</span> dir <span class="ot">*</span> <span class="dv">300</span>
            velocity <span class="ot">=</span> math<span class="ot">.</span>clamp<span class="ot">(</span>velocity<span class="ot">,</span> min_v<span class="ot">,</span> max_v<span class="ot">)</span>
            <span class="co">-- set a random spin</span>
            spin <span class="ot">=</span> <span class="fu">math.random</span><span class="ot">()</span> <span class="ot">*</span> <span class="dv">4</span> <span class="ot">-</span> <span class="dv">2</span>
            <span class="co">-- play bounce sound</span>
            scene:action<span class="ot">(</span>am<span class="ot">.</span>play<span class="ot">(</span><span class="st">&quot;bounce.ogg&quot;</span><span class="ot">))</span>
            on_ground <span class="ot">=</span> <span class="kw">false</span>
        <span class="kw">end</span>
    <span class="kw">end</span>

    <span class="co">-- update the ball position</span>
    ball_pos <span class="ot">=</span> ball_pos <span class="ot">+</span> velocity <span class="ot">*</span> am<span class="ot">.</span>delta_time

    <span class="co">-- if the ball lands on the ground, set the</span>
    <span class="co">-- velocity and spin to zero.</span>
    <span class="kw">if</span> ball_pos<span class="ot">.</span>y <span class="ot">&lt;=</span> <span class="ot">-</span><span class="dv">60</span> <span class="kw">and</span> <span class="kw">not</span> on_ground <span class="kw">then</span>
        velocity <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span>
        spin <span class="ot">=</span> <span class="dv">0</span>
        <span class="co">-- play land sound</span>
        scene:action<span class="ot">(</span>am<span class="ot">.</span>play<span class="ot">(</span><span class="st">&quot;land.ogg&quot;</span><span class="ot">))</span>
        on_ground <span class="ot">=</span> <span class="kw">true</span>
    <span class="kw">end</span>

    <span class="co">-- clamp the ball position so it doesn&#39;t dissapear</span>
    <span class="co">-- off the edge of the screen</span>
    ball_pos <span class="ot">=</span> math<span class="ot">.</span>clamp<span class="ot">(</span>ball_pos<span class="ot">,</span> min_pos<span class="ot">,</span> max_pos<span class="ot">)</span>

    <span class="co">-- update the ball angle</span>
    ball_angle <span class="ot">=</span> ball_angle <span class="ot">+</span> spin <span class="ot">*</span> am<span class="ot">.</span>delta_time

    <span class="co">-- update the ball translate and rotate nodes</span>
    scene<span class="st">&quot;ballt&quot;</span><span class="ot">.</span>position2d <span class="ot">=</span> ball_pos
    scene<span class="st">&quot;ballr&quot;</span><span class="ot">.</span>angle <span class="ot">=</span> ball_angle

    <span class="co">-- apply gravity to the velocity</span>
    velocity <span class="ot">=</span> velocity <span class="ot">+</span> gravity <span class="ot">*</span> am<span class="ot">.</span>delta_time
<span class="kw">end</span><span class="ot">)</span>

<span class="co">-- play ocean sound in a loop</span>
win<span class="ot">.</span>scene:action<span class="ot">(</span>am<span class="ot">.</span>play<span class="ot">(</span><span class="st">&quot;ocean.ogg&quot;</span><span class="ot">,</span> <span class="kw">true</span><span class="ot">))</span></code></pre></div>
<h1 id="maths">Maths</h1>
<div class="figure">
<img src="images/screenshot1.jpg" alt="" />

</div>
<h2 id="vectors">Vectors</h2>
<p>Amulet has built-in support for 2, 3 or 4 dimensional vectors. Vectors are typically used to represent things like position, direction or velocity in 2 or 3 dimensional space. Representing RGBA colors is another common use of 4 dimensional vectors.</p>
<p>In Amulet vectors are immutable. This means that once you create a vector, its value cannot be changed. Instead you need to construct a new vector with a new value.</p>
<p><strong>Note</strong>: Each component of a vector is represented internally as a 32 bit float, so expect some loss of precision when converting between vector components and Lua numbers, which are 64 bit floats.</p>
<h3 id="constructing-vectors">Constructing vectors</h3>
<p>To construct a vector use one of the functions <code>vec2</code>, <code>vec3</code> or <code>vec4</code>. A vector may be constructed by passing its components as separate arguments to one of these functions, for example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> velocity <span class="ot">=</span> vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">)</span></code></pre></div>
<p>Passing a single number to a vector constructor will set all components of the vector to that value. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> origin <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span></code></pre></div>
<p>sets <code>origin</code> to the value <code>vec2(0, 0)</code>.</p>
<p>It's also possible to construct a vector from a combination of other vectors and numbers. The new vector's components will be taken from the other vectors in the order they are passed in. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> bottom_left <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">)</span>
<span class="kw">local</span> top_right <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">10</span><span class="ot">,</span> <span class="dv">100</span><span class="ot">)</span>
<span class="kw">local</span> rect <span class="ot">=</span> vec4<span class="ot">(</span>bottom_left<span class="ot">,</span> top_right<span class="ot">)</span></code></pre></div>
<p>sets <code>rect</code> to <code>vec4(0, 0, 10, 100)</code></p>
<h3 id="accessing-vector-components">Accessing vector components</h3>
<p>There are multiple ways to access the components of a vector. The first component can be accessed using any of the fields <code>x</code>, <code>r</code> or <code>s</code>; the second using any of the fields <code>y</code>, <code>g</code> or <code>t</code>; the third using any of the fields <code>z</code>, <code>b</code> or <code>p</code>; and the fourth using any of the fields <code>w</code>, <code>a</code> or <code>q</code>. Here are some examples:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> color <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">0.1</span><span class="ot">,</span> <span class="dv">0.3</span><span class="ot">,</span> <span class="dv">0.7</span><span class="ot">,</span> <span class="dv">0.8</span><span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span>color<span class="ot">.</span>r<span class="ot">..</span><span class="st">&quot;, &quot;</span><span class="ot">..</span>color<span class="ot">.</span>g<span class="ot">..</span><span class="st">&quot;, &quot;</span><span class="ot">..</span>color<span class="ot">.</span>b<span class="ot">..</span><span class="st">&quot;, &quot;</span><span class="ot">..</span>color<span class="ot">.</span>a<span class="ot">)</span>
<span class="kw">local</span> point <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">5</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span><span class="st">&quot;x=&quot;</span><span class="ot">..</span>point<span class="ot">.</span>x<span class="ot">..</span><span class="st">&quot;, y=&quot;</span><span class="ot">..</span>point<span class="ot">.</span>y<span class="ot">)</span></code></pre></div>
<p>A vector's components can also be accessed with 1-based integer indices.</p>
<p>Vectors support the Lua length operator (<code>#</code>), which returns the number of components of the vector (not its magnitude). This allows for iterating through the components of a vector of unknown size, for example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> v <span class="ot">=</span> vec3<span class="ot">(</span><span class="dv">10</span><span class="ot">,</span> <span class="dv">20</span><span class="ot">,</span> <span class="dv">30</span><span class="ot">)</span>
<span class="kw">for</span> i <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span> <span class="ot">#</span>v <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>position<span class="ot">[</span>i<span class="ot">])</span>
<span class="kw">end</span></code></pre></div>
<h3 id="swizzle-fields">Swizzle fields</h3>
<p>Another way to construct vectors is to recombine the components of an existing vector using <em>swizzle fields</em>, which are special fields whose names consist of a combination of any of the component field characters. A new vector containing the named components will be returned. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> dir <span class="ot">=</span> vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span>dir<span class="ot">.</span>xy<span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span>dir<span class="ot">.</span>rggb<span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span>dir<span class="ot">.</span>zzys<span class="ot">)</span></code></pre></div>
<p>Running the above code results in the following output:</p>
<pre class="sourceCode text"><code>vec2(1, 2)
vec4(1, 2, 2, 3)
vec4(3, 3, 2, 1)</code></pre>
<p><strong>Note:</strong> You can pass vectors, matrices and quaternions directly to <code>print</code> or other functions that expect strings and they will be formatted appropriately.</p>
<h3 id="vector-update-syntax">Vector update syntax</h3>
<p>Although you can't directly set the components of a vector, Amulet provides some syntactic sugar to make it easier to create a new vector from an existing vector that has only some fields changed. Say, for example, you had a 3 dimensional vector, <code>v1</code>, and you wanted to create a new vector, <code>v2</code>, that had the same components as <code>v1</code>, except for the y component, which you'd like to be 10. One way to do this would be to write:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">v2 <span class="ot">=</span> vec3<span class="ot">(</span>v1<span class="ot">.</span>x<span class="ot">,</span> <span class="dv">10</span><span class="ot">,</span> v1<span class="ot">.</span>z<span class="ot">)</span></code></pre></div>
<p>but Amulet also allows you to write:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">v2 <span class="ot">=</span> v1<span class="ot">{</span>y <span class="ot">=</span> <span class="dv">10</span><span class="ot">}</span></code></pre></div>
<p>You can use this syntax to &quot;update&quot; multiple components and it also supports swizzle fields. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> v <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">)</span>
v <span class="ot">=</span> v<span class="ot">{</span>x <span class="ot">=</span> <span class="dv">5</span><span class="ot">,</span> ba <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">6</span><span class="ot">)}</span></code></pre></div>
<p>This would set <code>v</code> to <code>vec4(5, 2, 6, 6)</code>.</p>
<p>If the values of a swizzle field are going to be updated to the same value (as with <code>ba</code> above), you can just set the field to the value instead of constructing a vector. So the above could also have been written as:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">v <span class="ot">=</span> v<span class="ot">{</span>x <span class="ot">=</span> <span class="dv">5</span><span class="ot">,</span> ba <span class="ot">=</span> <span class="dv">6</span><span class="ot">}</span></code></pre></div>
<h3 id="vector-arithmetic">Vector arithmetic</h3>
<p>You can do arithmetic with vectors using the standard operators <code>+</code>, <code>-</code>, <code>*</code> and <code>/</code>. If both operands are vectors then they should have the same size and the operation is applied in a component-wise fashion, yielding a new vector of the same size. If one operand is a number then the operation is applied to each component of the vector, yielding a new vector of the same size as the vector operand. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="fu">print</span><span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">)</span> <span class="ot">+</span> <span class="dv">1</span><span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span>vec3<span class="ot">(</span><span class="dv">30</span><span class="ot">)</span> <span class="ot">/</span> vec3<span class="ot">(</span><span class="dv">3</span><span class="ot">,</span> <span class="dv">10</span><span class="ot">,</span> <span class="dv">5</span><span class="ot">))</span>
<span class="fu">print</span><span class="ot">(</span><span class="dv">2</span> <span class="ot">*</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">))</span></code></pre></div>
<p>produces the following output:</p>
<pre class="sourceCode text"><code>vec2(4, 5)
vec3(10, 3, 6)
vec4(2, 4, 6, 8)</code></pre>
<div class="figure">
<img src="images/screenshot4.jpg" alt="" />

</div>
<h2 id="matrices">Matrices</h2>
<p>Amulet has built-in support for 2x2, 3x3 and 4x4 matrices. Matrices are typically used to represent transformations in 2 or 3 dimensional space such as rotation, scaling, translation or perspective projection.</p>
<p>Matrices, like vectors, are immutable and their components are represented internally as 32 bit floats.</p>
<h3 id="constructing-matrices">Constructing matrices</h3>
<p>Use one of the functions <code>mat2</code>, <code>mat3</code> or <code>mat4</code> to contruct a 2x2, 3x3 or 4x4 matrix.</p>
<p>Passing a single number argument to one of the matrix constructors generates a matrix with all diagonal elements equal to the number and all other elements equal to zero. For example <code>mat3(1)</code> constructs the 3x3 identity matrix:</p>
<p><br /><span class="math display">$$\begin{bmatrix}
    1 &amp; 0 &amp; 0 \\
    0 &amp; 1 &amp; 0 \\
    0 &amp; 0 &amp; 1
\end{bmatrix}$$</span><br /></p>
<p>You can also pass the individual elements of the matrix as arguments to one of the constructors. These can either be numbers or vectors or a mix of the two. As the constructor arguments are consumed from left to right, the matrix is filled in column by column. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> m <span class="ot">=</span> mat3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span>
               <span class="dv">4</span><span class="ot">,</span> <span class="dv">5</span><span class="ot">,</span> <span class="dv">6</span><span class="ot">,</span>
               <span class="dv">7</span><span class="ot">,</span> <span class="dv">8</span><span class="ot">,</span> <span class="dv">9</span><span class="ot">)</span></code></pre></div>
<p>sets <code>m</code> to the matrix:</p>
<p><br /><span class="math display">$$\begin{bmatrix}
    1 &amp; 4 &amp; 7 \\
    2 &amp; 5 &amp; 8 \\
    3 &amp; 6 &amp; 9
\end{bmatrix}$$</span><br /></p>
<p>Here's another example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> m <span class="ot">=</span> mat4<span class="ot">(</span>vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">),</span> <span class="dv">4</span><span class="ot">,</span>
               vec4<span class="ot">(</span><span class="dv">5</span><span class="ot">,</span> <span class="dv">6</span><span class="ot">,</span> <span class="dv">7</span><span class="ot">,</span> <span class="dv">8</span><span class="ot">),</span>
               vec2<span class="ot">(</span><span class="dv">9</span><span class="ot">,</span> <span class="dv">10</span><span class="ot">),</span> vec2<span class="ot">(</span><span class="dv">11</span><span class="ot">,</span> <span class="dv">12</span><span class="ot">),</span>
               <span class="dv">13</span><span class="ot">,</span> <span class="dv">14</span><span class="ot">,</span> <span class="dv">15</span><span class="ot">,</span> <span class="dv">16</span><span class="ot">)</span></code></pre></div>
<p>This sets <code>m</code> to the matrix:</p>
<p><br /><span class="math display">$$\begin{bmatrix}
    1 &amp;  5 &amp;  9 &amp; 13 \\ 
    2 &amp;  6 &amp; 10 &amp; 14 \\ 
    3 &amp;  7 &amp; 11 &amp; 15 \\ 
    4 &amp;  8 &amp; 12 &amp; 16
\end{bmatrix}$$</span><br /></p>
<p><strong>Note</strong>: Matrix constructors are admittedly somewhat confusing, because when you write the matrix constructor in code the columns are layed out horizontally. This is however the convention used in the OpenGL Shader Language (GLSL).</p>
<p>A matrix can also be constructed by passing an existing matrix to one of the matrix construction functions. If the existing matrix is larger than the construction function, the new matrix's elements come from the top-left corner of the existing matrix. Otherwise the top-left corner of the new matrix is filled with the contents of the existing matrix and the rest from the identity matrix. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> m <span class="ot">=</span> mat4<span class="ot">(</span>mat2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">))</span></code></pre></div>
<p>will set <code>m</code> to the matrix:</p>
<p><br /><span class="math display">$$\begin{bmatrix}
    1 &amp; 3 &amp; 0 &amp; 0 \\
    2 &amp; 4 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 1 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}$$</span><br /></p>
<p>Finally a 3x3 or 4x4 rotation matrix can be constructed from a quaternion by passing the quaternion as the single argument to <code>mat3</code> or <code>mat4</code> (see quaternions).</p>
<h3 id="accessing-matrix-components">Accessing matrix components</h3>
<p>The columns of a matrix can be accessed as vectors using 1-based integer indices. The Lua length operator can be used to determine the number of columns. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> matrix <span class="ot">=</span> mat2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span>
<span class="kw">for</span> i <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span> <span class="ot">#</span>matrix <span class="kw">do</span>
    <span class="fu">print</span><span class="ot">(</span>matrix<span class="ot">[</span>i<span class="ot">])</span>
<span class="kw">end</span></code></pre></div>
<p>This would produce the following output:</p>
<pre class="sourceCode text"><code>vec2(1, 0)
vec2(0, 2)</code></pre>
<h3 id="matrix-arithmetic">Matrix arithmetic</h3>
<p>As with vectors the <code>+</code>, <code>-</code>, <code>*</code> and <code>/</code> operators work with matrices too. When one operand is a number, the result is a new matrix of the same size with the operator applied to each element of the matrix. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> m1 <span class="ot">=</span> <span class="dv">2</span> <span class="ot">*</span> mat2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">)</span></code></pre></div>
<p>sets <code>m1</code> to the matrix:</p>
<p><br /><span class="math display">$$\begin{bmatrix}
    2 &amp; 6 \\
    4 &amp; 8
\end{bmatrix}$$</span><br /></p>
<p>and:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> m2 <span class="ot">=</span> mat3<span class="ot">(</span><span class="dv">3</span><span class="ot">)</span> <span class="ot">-</span> <span class="dv">1</span></code></pre></div>
<p>sets <code>m2</code> to the matrix:</p>
<p><br /><span class="math display">$$\begin{bmatrix}
    2 &amp; -1 &amp; -1 \\
    -1 &amp; 2 &amp; -1 \\
    -1 &amp; -1 &amp; 2
\end{bmatrix}$$</span><br /></p>
<p>When both operands are matrices, the <code>+</code> and <code>-</code> operators work in a similar way to vectors, with the operations applied component-wise. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> m3 <span class="ot">=</span> mat2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">4</span><span class="ot">)</span> <span class="ot">+</span> mat2<span class="ot">(</span><span class="dv">0.1</span><span class="ot">,</span> <span class="dv">0.2</span><span class="ot">,</span> <span class="dv">0.3</span><span class="ot">,</span> <span class="dv">0.4</span><span class="ot">)</span></code></pre></div>
<p>sets <code>m3</code> to the matrix:</p>
<p><br /><span class="math display">$$\begin{bmatrix}
    1.1 &amp; 3.3 \\
    2.2 &amp; 4.4
\end{bmatrix}$$</span><br /></p>
<p>However, when both operands are matrices, the <code>*</code> operator computes the <a href="http://en.wikipedia.org/wiki/Matrix_multiplication">matrix product</a>.</p>
<p>If the first operand is a vector and the second is a matrix, then the first operand is taken to be a row vector (a matrix with one row) and should have the same number of columns as the matrix. The result is the matrix product of the row vector and the matrix (another row vector).</p>
<p>Similarly if the first argument is a matrix and the second a vector, the vector is taken to be a column vector (a matrix with one column) and the result is the matrix product of the matrix and column vector, which is another column vector.</p>
<p>The <code>/</code> operator also works when both arguments are matrices and is equivalent to multiplying by the first matrix by the inverse of the second.</p>
<div class="figure">
<img src="images/screenshot2.jpg" alt="" />

</div>
<h2 id="quaternions">Quaternions</h2>
<p><a href="https://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation">Quaternions</a> are useful for representing 3D rotations.</p>
<p>Like vectors and matrices they are immutable.</p>
<h3 id="constructing-quaternions">Constructing quaternions</h3>
<p>The <code>quat</code> function is used to construct quaternions. The simplest way to construct a quaternion is to pass an angle (in radians) and a unit 3D vector representing the axis about which the rotation should occur. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> q <span class="ot">=</span> quat<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">45</span><span class="ot">),</span> vec3<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">))</span></code></pre></div>
<p>constructs a quaternion that represents a 45 degree rotation around the z axis. (<code>math.rad</code> converts radians to degrees).</p>
<p>If the axis argument is omitted then it is taken to be <code>vec3(0, 0, 1)</code>, so the above is equivalent to:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> q <span class="ot">=</span> quat<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">45</span><span class="ot">))</span></code></pre></div>
<p>This is a useful shortcut for 2D rotations in the xy plane.</p>
<p>A quaternion can also be constructed from euler angles. Euler angles are rotations around the x, y and z axes, also known as pitch, roll and yaw. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> q <span class="ot">=</span> quat<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">30</span><span class="ot">),</span> <span class="fu">math.rad</span><span class="ot">(</span><span class="dv">60</span><span class="ot">),</span> <span class="fu">math.rad</span><span class="ot">(</span><span class="dv">20</span><span class="ot">))</span></code></pre></div>
<p>constructs a quaternion that represents the rotation you'd end up with if you first rotated 30 degrees around the x axis, then 60 degrees around the y axis and finally 20 degrees around the z axis.</p>
<p>If two unit vector arguments are given, then the quaternion represents the rotation that would be needed to rotate the one vector into into the other. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> q <span class="ot">=</span> quat<span class="ot">(</span>vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">),</span> vec3<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">))</span></code></pre></div>
<p>The above quaternion represents a rotation of 90 degrees in the xy plane, since it rotates a vector pointing along the x axis to one pointing along the y axis.</p>
<p>A quaternion can be constructed from a 3x3 or 4x4 matrix by passing the matrix as the single argument to <code>quat</code>.</p>
<p>A quaternion can also be converted to a 3x3 or 4x4 matrix by passing it as the single argument to the <code>mat3</code> or <code>mat4</code> functions (see mat-cons).</p>
<p>Finally a quaternion can be contructed from the coefficients of its real and imaginary parts:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> q <span class="ot">=</span> quat<span class="ot">(</span>w<span class="ot">,</span> x<span class="ot">,</span> y<span class="ot">,</span> z<span class="ot">)</span></code></pre></div>
<p><code>w</code> is the real part and <code>x</code>, <code>y</code> and <code>z</code> are the coeffients of the imaginary numbers <span class="math inline"><em>i</em></span>, <span class="math inline"><em>j</em></span> and <span class="math inline"><em>k</em></span>.</p>
<h3 id="quaternion-fields">Quaternion fields</h3>
<p>The <code>angle</code>, <code>axis</code>, <code>pitch</code>, <code>roll</code>, <code>yaw</code>, <code>w</code>, <code>x</code>, <code>y</code> and <code>z</code> fields can be used to read the corresponding attributes of a quaternion.</p>
<p><strong>Note</strong>: Quaternions use a normalized internal representation, so the value returned by a field might be different from the value used to construct the quaternion. Though the quaternion as a whole represents the equivalent rotatation.</p>
<h3 id="quaternion-operations">Quaternion operations</h3>
<p>Quaternions can be multiplied together using the <code>*</code> operator. The result of multiplying 2 quaternions is the rotation that results from applying the first quaternion's rotation followed by the second quaternion's rotation.</p>
<p>Multiplying a quaternion by a vector rotates the vector. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> v1 <span class="ot">=</span> vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)</span>
<span class="kw">local</span> q <span class="ot">=</span> quat<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">90</span><span class="ot">),</span> vec3<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">))</span>
<span class="kw">local</span> v2 <span class="ot">=</span> q <span class="ot">*</span> v1</code></pre></div>
<p>would set <code>v2</code> to the vector <code>vec3(0, 1, 0)</code>, which is <code>v1</code> rotated 90 degrees in the xy plain.</p>
<p>A <code>vec2</code> can be rotated in a similar way (the z component is assumed to be zero and the z component of the result is dropped, yielding another <code>vec2</code>).</p>
<h1 id="buffers-and-views">Buffers and views</h1>
<h2 id="buffers">Buffers</h2>
<h2 id="views">Views</h2>
<h1 id="scene-graphs">Scene graphs</h1>
<p>Scene graphs are how you draw graphics in Amulet. <em>Scene nodes</em> are connected together to form a scene graph which is attached to a window. The window will then render the scene graph each frame.</p>
<p>Scene nodes correspond to graphics commands. They either change the rendering state in some way, for example by applying a transformation or changing the blend mode, or execute a draw command, which renders something to the screen.</p>
<p>Each scene node has a list of children, which are rendered in order.</p>
<p>A scene node may be the child of multiple other scene nodes, so in general a scene node does not have a unique parent. Cycles are also allowed and are handled by imposing a limit to the number of times a node can be recursively rendered.</p>
<h2 id="scene-graph-construction-syntax">Scene graph construction syntax</h2>
<p>Special syntax is provided for constructing scene graphs from nodes. The expression:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">node1 <span class="ot">^</span> node2</code></pre></div>
<p>adds <code>node2</code> as a child of <code>node1</code> and returns <code>node1</code>. The resulting scene graph looks like this:</p>
<div class="figure">
<img src="graphs/scene4.png" alt="" />

</div>
<p>The expression:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">node1 <span class="ot">^</span> <span class="ot">{</span> node2<span class="ot">,</span> node3 <span class="ot">}</span></code></pre></div>
<p>adds both <code>node2</code> and <code>node3</code> as children of <code>node1</code> and returns <code>node1</code>:</p>
<div class="figure">
<img src="graphs/scene5.png" alt="" />

</div>
<p>The expression:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">node1 <span class="ot">^</span> <span class="ot">{</span> node2<span class="ot">,</span> node3 <span class="ot">}</span> <span class="ot">^</span> node4</code></pre></div>
<p>does the same as the previous expression, except <code>node4</code> is added as a child of both <code>node2</code> and <code>node3</code>:</p>
<div class="figure">
<img src="graphs/scene6.png" alt="" />

</div>
<p>If <code>node2</code> or <code>node3</code> were graphs with multiple nodes, then <code>node4</code> would be added to the leaf nodes of those graphs.</p>
<p>Here is a more complex example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">node1 
    <span class="ot">^</span> node2
    <span class="ot">^</span> <span class="ot">{</span>
        node3
        <span class="ot">^</span> node4
        <span class="ot">,</span>
        node5
        <span class="ot">^</span> <span class="ot">{</span>node6<span class="ot">,</span> node7<span class="ot">,</span> node8<span class="ot">}</span>
    <span class="ot">}</span>
    <span class="ot">^</span> node9
    <span class="ot">^</span> node10</code></pre></div>
<p>The above expression results in the following graph:</p>
<div class="figure">
<img src="graphs/scene7.png" alt="" />

</div>
<h2 id="scene-node-common-methods">Scene node common methods</h2>
<p>The following methods are common to all scene nodes.</p>
<h3 id="node:tag" class="method-def">node:tag(tagname)</h3>
<p>Adds a tag to a node and returns the node. <code>tagname</code> should be a string.</p>
<p>Note that most scene nodes receive a default tag name when they are created. See the documentation of the different nodes below for what these default tags are.</p>
<p>No more than 65535 unique tag names may be created in a single application.</p>
<h3 id="node:untag" class="method-def">node:untag(tagname)</h3>
<p>Removes a tag from a node and returns the node.</p>
<h3 id="node:all" class="method-def">node:all(tagname)</h3>
<p>Searches <code>node</code> and all its descendents for any nodes with the tag <code>tagname</code> and returns them as a table.</p>
<h3 id="node:tagsearch" class="method-def">node(tagname)</h3>
<p>Searches <code>node</code> and its descendents for <code>tagname</code> and returns the first matching node found, or <code>nil</code> if no matching nodes were found. The search is depth-first left-to-right.</p>
<h3 id="node:action" class="method-def">node:action([id,] action)</h3>
<p>Attaches an action to a node and returns the node.</p>
<p><code>action</code> may be a function or a coroutine.</p>
<p>The action function will be called exactly once per frame as long as the node is part of a scene graph that is attached to a window. If a coroutine is used, it will be run until it yields or finishes. The action will be run for the first time on the frame after it was attached to the node.</p>
<p>The action function may accept a single argument which is the node to which it is attached. If a coroutine is used, then the node is returned by <code>coroutine.yield()</code>.</p>
<p>If the action function returns <code>true</code> then the action will be removed from the node and not run again. Similarly if a coroutine yields <code>true</code> or finishes.</p>
<p>Each action has an ID. If the <code>id</code> argument is omitted, then its ID is the value of the <code>action</code> argument. If present, <code>id</code> may be a value of any type besides nil, a function or coroutine (typically it's a string).</p>
<p>Multiple actions may be attached to a scene node, but they must all have unique ids. If you attempt to attach an action with an ID that is already used by another action on the same node, then the other action will be removed before the new one is attached.</p>
<p>The order that actions are run is determined by the node's position in the scene graph. Each node is visited in depth-first, left-to-right order and the actions on each node are run in the order they were added to the node. Each action is never run more than once, even if the node occurs multiple times in the graph or is part of a cycle. For example, given the following scene graph:</p>
<div class="figure">
<img src="graphs/scene8.png" alt="" />

</div>
<p>The nodes will be visited in this order:</p>
<ul>
<li><code>node1</code></li>
<li><code>node2</code></li>
<li><code>node4</code></li>
<li><code>node5</code></li>
<li><code>node7</code></li>
<li><code>node6</code></li>
<li><code>node3</code></li>
</ul>
<p>Note that the action execution order is determined before the first action runs and is not affected by any modifications actions make to the scene graph (these modifications will only affect the order of actions in subsequent frames).</p>
<h3 id="node:late_action" class="method-def">node:late_action([id,] action)</h3>
<p>Attach a <em>late action</em> to a scene node. Late actions are the same as normal actions, except they are run after all normal actions are finished.</p>
<p>See also <a href="#node:action">node:action</a>.</p>
<h3 id="node:cancel" class="method-def">node:cancel(id)</h3>
<p>Cancels an action.</p>
<h3 id="nodeappendchild" class="func-def">node:append(child)</h3>
<p>Appends <code>child</code> to the end of <code>node</code>'s child list and returns <code>node</code>.</p>
<h3 id="nodeprependchild" class="func-def">node:prepend(child)</h3>
<p>Adds <code>child</code> to the start of <code>node</code>'s child list and returns <code>node</code>.</p>
<h3 id="noderemovechild" class="func-def">node:remove(child)</h3>
<p>Removes the first occurance of <code>child</code> from <code>node</code>'s child list and returns <code>node</code>.</p>
<h3 id="noderemovetagname" class="func-def">node:remove(tagname)</h3>
<p>Searches for a node with tag <code>tagname</code> in the descendents of <code>node</code> and removes the first one it finds and returns <code>node</code>.</p>
<h3 id="noderemove_all" class="func-def">node:remove_all()</h3>
<p>Removes all of <code>node</code>'s children and returns <code>node</code>.</p>
<h3 id="nodereplacechild-replacement" class="func-def">node:replace(child, replacement)</h3>
<p>Replaces the first occurance of <code>child</code> with <code>replacement</code> in <code>node</code>'s child list and returns <code>node</code>.</p>
<h3 id="nodereplacetagname-replacement" class="func-def">node:replace(tagname, replacement)</h3>
<p>Searches for a node with tag <code>tagname</code> in the descendents of <code>node</code> and replaces the first one it finds with <code>replacement</code> and returns <code>node</code>.</p>
<h3 id="nodechildn" class="func-def">node:child(n)</h3>
<p>Returns the nth child of <code>node</code> (or <code>nil</code> if there is no such child).</p>
<h3 id="nodechild_pairs" class="func-def">node:child_pairs()</h3>
<p>Returns an iterator over all <code>node</code>'s children. For example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">for</span> i<span class="ot">,</span> child <span class="kw">in</span> node:child_pairs<span class="ot">()</span> <span class="kw">do</span>
    <span class="co">-- do something with child</span>
<span class="kw">end</span></code></pre></div>
<h2 id="scene-node-common-fields">Scene node common fields</h2>
<p>The following fields are common to all scene nodes.</p>
<h3 id="node.hidden" class="func-def">node.hidden</h3>
<p>Determines whether the node and its children are rendered. The default is <code>false</code>, meaning that the node is rendered.</p>
<p>Updatable.</p>
<h3 id="node.paused" class="func-def">node.paused</h3>
<p>Determines whether the node and its children's actions are executed. The default is <code>false</code>, meaning the actions are executed.</p>
<p>Note that a descendent node's actions might still be executed if it is has another, non-paused, parent.</p>
<p>Updatable.</p>
<h3 id="node.num_children" class="func-def">node.num_children</h3>
<p>Returns the node's child count.</p>
<p>Readonly.</p>
<h3 id="node.recursion_limit" class="func-def">node.recursion_limit</h3>
<p>This determines the number of times the node will be rendered recursively when part of a cycle in the scene graph. The default is 8.</p>
<p>Updatable.</p>
<h2 id="core-scene-nodes">Core scene nodes</h2>
<h3 id="am.groupchildren" class="func-def">am.group(children)</h3>
<p>Group nodes are only for grouping child nodes under a common parent. They have no other effect. The children can be passed in as a table.</p>
<p>Default tag: <code>&quot;group&quot;</code>.</p>
<p>Example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> group_node <span class="ot">=</span> am<span class="ot">.</span>group<span class="ot">{</span>node1<span class="ot">,</span> node2<span class="ot">,</span> node3<span class="ot">}</span></code></pre></div>
<h3 id="am.use_program" class="func-def">am.use_program(program)</h3>
<p>Sets the shader program to use when rendering descendents. A <code>program</code> object can be created using the <a href="#am.program"><code>am.program</code></a> function.</p>
<p>Fields:</p>
<ul>
<li><code>program</code>: The shader program to use. Updatable.</li>
</ul>
<p>Default tag: <code>&quot;use_program&quot;</code>.</p>
<h3 id="am.bind" class="func-def">am.bind(bindings)</h3>
<p>Binds shader program parameters (uniforms and attributes). <code>bindings</code> is a table mapping shader parameters names to values.</p>
<p>The named parameters are matched with the uniforms and attributes in the shader program just before a <a href="#am.draw"><code>am.draw</code></a> node is encountered. Any bound parameters not in the program are ignored, but all program parameters must have been bound before the draw node is encountered.</p>
<p>Attributes should be bound to buffer views of the required type.</p>
<p>The name parameters are available as updatable fields on the bind node. The fields have the same names as their corresponding parameters.</p>
<p>Default tag: <code>&quot;bind&quot;</code>.</p>
<p>Example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> bind_node <span class="ot">=</span> am<span class="ot">.</span>bind<span class="ot">{</span>
    P <span class="ot">=</span> mat4<span class="ot">(</span><span class="dv">1</span><span class="ot">),</span>
    MV <span class="ot">=</span> mat4<span class="ot">(</span><span class="dv">1</span><span class="ot">),</span>
    color <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span>
    vert <span class="ot">=</span> am<span class="ot">.</span>vec2_array<span class="ot">{</span>
        vec2<span class="ot">(-</span><span class="dv">1</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">1</span><span class="ot">),</span>
        vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span>
        vec2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">1</span><span class="ot">)</span>
    <span class="ot">}</span>
<span class="ot">}</span>
<span class="co">-- update a parameter</span>
bind_node<span class="ot">.</span>color <span class="ot">=</span> vec4<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span></code></pre></div>
<h3 id="am.draw" class="func-def">am.draw(primitive [, elements] [, first [, count]])</h3>
<p>Draws the currently bound vertices using the current shader program with the currently bound parameter values.</p>
<p><code>primitive</code> can be one of the following:</p>
<ul>
<li><code>&quot;points&quot;</code></li>
<li><code>&quot;lines&quot;</code></li>
<li><code>&quot;line_strip&quot;</code></li>
<li><code>&quot;line_loop&quot;</code></li>
<li><code>&quot;triangles&quot;</code></li>
<li><code>&quot;triangle_strip&quot;</code></li>
<li><code>&quot;triangle_fan&quot;</code></li>
</ul>
<p>Note that <code>&quot;line_loop&quot;</code> and <code>&quot;triangle_fan&quot;</code> may be slow on some systems.</p>
<p><code>elements</code>, if supplied, should be a <code>ushort_elem</code> or <code>uint_elem</code> view containing 1-based attribute indices. If omitted the attributes are rendered in order as if <code>elements</code> were 1, 2, 3, 4, 5, ... etc. See also <a href="#buffers-and-views">buffers and views</a>.</p>
<p><code>first</code> specifies where in the list of vertices to start drawing (starting from 1). The default is 1.</p>
<p><code>count</code> specifies how many vertices to draw. The default is as many as are supplied through bound vertex attributes and the <code>elements</code> view if present.</p>
<p>Fields:</p>
<ul>
<li><code>primitive</code>: The primitive to draw. Updatable.</li>
<li><code>elements</code>: The elements view. Updatable.</li>
<li><code>first</code>: The first vertex to draw. Updatable.</li>
<li><code>count</code>: The number of vertices to draw. Updatable.</li>
</ul>
<p>Default tag: <code>&quot;draw&quot;</code>.</p>
<p>Here is a complete example that draws a triangle with red, green and blue corners using <a href="#am.use_progam"><code>am.use_program</code></a>, <a href="#am.bind"><code>am.bind</code></a> and <a href="#am.draw"><code>am.draw</code></a> nodes:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{}</span>
<span class="kw">local</span> prog <span class="ot">=</span> am<span class="ot">.</span>program<span class="ot">(</span><span class="st">[[</span>
<span class="st">    precision highp float;</span>
<span class="st">    attribute vec2 vert;</span>
<span class="st">    attribute vec4 color;</span>
<span class="st">    uniform mat4 MV;</span>
<span class="st">    uniform mat4 P;</span>
<span class="st">    varying vec4 v_color;</span>
<span class="st">    void main() {</span>
<span class="st">        v_color = color;</span>
<span class="st">        gl_Position = P * MV * vec4(vert, 0.0, 1.0);</span>
<span class="st">    }</span>
<span class="st">]]</span><span class="ot">,</span> <span class="st">[[</span>
<span class="st">    precision mediump float;</span>
<span class="st">    varying vec4 v_color;</span>
<span class="st">    void main() {</span>
<span class="st">        gl_FragColor = v_color;</span>
<span class="st">    }</span>
<span class="st">]]</span><span class="ot">)</span>
win<span class="ot">.</span>scene <span class="ot">=</span>
    am<span class="ot">.</span>use_program<span class="ot">(</span>prog<span class="ot">)</span>
    <span class="ot">^</span> am<span class="ot">.</span>bind<span class="ot">{</span>
        P <span class="ot">=</span> mat4<span class="ot">(</span><span class="dv">1</span><span class="ot">),</span>
        MV <span class="ot">=</span> mat4<span class="ot">(</span><span class="dv">1</span><span class="ot">),</span>
        color <span class="ot">=</span> am<span class="ot">.</span>vec4_array<span class="ot">{</span>
            vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span>
            vec4<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span>
            vec4<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
        <span class="ot">},</span>
        vert <span class="ot">=</span> am<span class="ot">.</span>vec2_array<span class="ot">{</span>
            vec2<span class="ot">(-</span><span class="dv">1</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">1</span><span class="ot">),</span>
            vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span>
            vec2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">1</span><span class="ot">)</span>
        <span class="ot">}</span>
    <span class="ot">}</span>
    <span class="ot">^</span> am<span class="ot">.</span>draw<span class="st">&quot;triangles&quot;</span></code></pre></div>
<p>The resulting image looks like this:</p>
<div class="figure">
<img src="images/rgb_triangle.png" alt="" />

</div>
<h3 id="am.translate" class="func-def">am.translate([uniform,] position)</h3>
<p>Apply a translation to a 4x4 matrix uniform. <code>uniform</code> is the uniform name as a string. It is <code>&quot;MV&quot;</code> by default.</p>
<p><code>position</code> may be either 2 or 3 numbers (the x, y and z components) or a <code>vec2</code> or <code>vec3</code>.</p>
<p>If the z component is omitted it is assumed to be 0.</p>
<p>Fields:</p>
<ul>
<li><code>position</code>: The translation position as <code>vec3</code>. Updatable.</li>
<li><code>position2d</code>: The translation position as <code>vec2</code>. Updatable.</li>
</ul>
<p>Default tag: <code>&quot;translate&quot;</code>.</p>
<p>Example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> node1 <span class="ot">=</span> am<span class="ot">.</span>translate<span class="ot">(</span><span class="dv">10</span><span class="ot">,</span> <span class="dv">20</span><span class="ot">)</span>
<span class="kw">local</span> node2 <span class="ot">=</span> am<span class="ot">.</span>translate<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">10</span><span class="ot">,</span> <span class="dv">20</span><span class="ot">))</span>
<span class="kw">local</span> node3 <span class="ot">=</span> am<span class="ot">.</span>translate<span class="ot">(</span><span class="st">&quot;MyModelViewMatrix&quot;</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">3.5</span><span class="ot">)</span>
<span class="kw">local</span> node4 <span class="ot">=</span> am<span class="ot">.</span>translate<span class="ot">(</span>vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">))</span>
<span class="kw">local</span> node1<span class="ot">.</span>position2d <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">30</span><span class="ot">,</span> <span class="dv">40</span><span class="ot">)</span>
<span class="kw">local</span> node3<span class="ot">.</span>position <span class="ot">=</span> vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">3</span><span class="ot">)</span></code></pre></div>
<h3 id="am.scale" class="func-def">am.scale([uniform,] scaling)</h3>
<p>Apply a scale transform to a 4x4 matrix uniform. <code>uniform</code> is the uniform name as a string. It is <code>&quot;MV&quot;</code> by default.</p>
<p><code>scaling</code> may be 1, 2 or 3 numbers or a <code>vec2</code> or <code>vec3'. If 1 number is provided it is assume to be the x and y components of the scaling and the z scaling is assumed to be 1. If 2 numbers or a</code>vec2` is provided, they are the scaling for the x and y components and z is assumed to be 1.</p>
<p>Fields:</p>
<ul>
<li><code>scale</code>: The scale as a <code>vec3</code>. Updatable.</li>
<li><code>scale2d</code>: The scale as a <code>vec2</code>. Updatable.</li>
</ul>
<p>Default tag: <code>&quot;scale&quot;</code>.</p>
<p>Example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> node1 <span class="ot">=</span> am<span class="ot">.</span>scale<span class="ot">(</span><span class="dv">2</span><span class="ot">)</span>
<span class="kw">local</span> node2 <span class="ot">=</span> am<span class="ot">.</span>scale<span class="ot">(</span><span class="dv">2</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
<span class="kw">local</span> node3 <span class="ot">=</span> am<span class="ot">.</span>scale<span class="ot">(</span>vec2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">))</span>
<span class="kw">local</span> node4 <span class="ot">=</span> am<span class="ot">.</span>scale<span class="ot">(</span><span class="st">&quot;MyModelViewMatrix&quot;</span><span class="ot">,</span> vec3<span class="ot">(</span><span class="dv">0.5</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">))</span>
node1<span class="ot">.</span>scale2d <span class="ot">=</span> vec2<span class="ot">(</span><span class="dv">1</span><span class="ot">)</span>
node4<span class="ot">.</span>scale <span class="ot">=</span> vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">3</span><span class="ot">,</span> <span class="dv">2</span><span class="ot">)</span></code></pre></div>
<h3 id="am.rotate" class="func-def">am.rotate([uniform,] rotation)</h3>
<p>Apply a rotation to a 4x4 matrix uniform. <code>uniform</code> is the uniform name as a string. It is <code>&quot;MV&quot;</code> by default.</p>
<p><code>rotation</code> can be either a quaternion, or an angle (in radians) followed by an optional <code>vec3</code> axis. If the axis is omitted it is assumed to be <code>vec3(0, 0, 1)</code> so the rotation becomes a 2D rotation in the xy plane.</p>
<p>Fields:</p>
<ul>
<li><code>rotation</code>: The rotation as a <code>quat</code>. Updatable.</li>
<li><code>angle</code>: The rotation angle in radians. Updatable.</li>
<li><code>axis</code>: The rotation axis as a <code>vec3</code>. Updatable.</li>
</ul>
<p>Default tag: <code>&quot;rotate&quot;</code>.</p>
<p>Example:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> node1 <span class="ot">=</span> am<span class="ot">.</span>rotate<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">45</span><span class="ot">))</span>
<span class="kw">local</span> node2 <span class="ot">=</span> am<span class="ot">.</span>rotate<span class="ot">(</span>math<span class="ot">.</span>pi<span class="ot">/</span><span class="dv">4</span><span class="ot">,</span> vec3<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">))</span>
<span class="kw">local</span> node3 <span class="ot">=</span> am<span class="ot">.</span>rotate<span class="ot">(</span><span class="st">&quot;MyModelViewMatrix&quot;</span><span class="ot">,</span> 
    quat<span class="ot">(</span>math<span class="ot">.</span>pi<span class="ot">/</span><span class="dv">6</span><span class="ot">,</span> vec3<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">)))</span>
node1<span class="ot">.</span>angle <span class="ot">=</span> <span class="fu">math.rad</span><span class="ot">(</span><span class="dv">60</span><span class="ot">)</span>
node2<span class="ot">.</span>axis <span class="ot">=</span> vec3<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)</span>
node3<span class="ot">.</span>rotation <span class="ot">=</span> quat<span class="ot">(</span><span class="fu">math.rad</span><span class="ot">(</span><span class="dv">60</span><span class="ot">),</span> vec3<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">))</span></code></pre></div>
<h3 id="am.blendmode" class="func-def">am.blend(mode)</h3>
<p>Set the blending mode.</p>
<p>The possible values for <code>mode</code> are:</p>
<ul>
<li><code>&quot;off&quot;</code></li>
<li><code>&quot;alpha&quot;</code></li>
<li><code>&quot;premult&quot;</code></li>
<li><code>&quot;add&quot;</code></li>
<li><code>&quot;subtract&quot;</code></li>
<li><code>&quot;add_alpha&quot;</code></li>
<li><code>&quot;subtract_alpha&quot;</code></li>
<li><code>&quot;multiply&quot;</code></li>
<li><code>&quot;invert&quot;</code></li>
</ul>
<p>Fields:</p>
<ul>
<li><code>mode</code>: Updatable.</li>
</ul>
<h3 id="am.cull_faceface" class="func-def">am.cull_face(face)</h3>
<p>Culls triangles with a specific winding.</p>
<p>The possible values for <code>face</code> are:</p>
<ul>
<li><code>&quot;cw&quot;</code>: Cull clockwise wound triangles.</li>
<li>`&quot;ccw&quot;: Cull counter-clockwise wound triangles.</li>
<li>`&quot;none&quot;: Do not cull any triangles.</li>
</ul>
<p>Fields:</p>
<ul>
<li><code>face</code>: Updatable.</li>
</ul>
<h3 id="am.depth_test" class="method-def">am.depth_test(test [, mask])</h3>
<p>Sets the depth test and mask. The window or framebuffer being rendered to needs to have a depth buffer for this to have any effect.</p>
<p><code>test</code> is used to determine whether a fragment is rendered by comparing the depth value of the fragment to value in the depth buffer. The possible values for <code>test</code> are:</p>
<ul>
<li><code>&quot;never&quot;</code></li>
<li><code>&quot;always&quot;</code></li>
<li><code>&quot;equal&quot;</code></li>
<li><code>&quot;notequal&quot;</code></li>
<li><code>&quot;less&quot;</code></li>
<li><code>&quot;lequal&quot;</code></li>
<li><code>&quot;greater&quot;</code></li>
<li><code>&quot;gequal&quot;</code></li>
</ul>
<p>Mask determines whether the fragment depth is written to the depth buffer. The possible values are <code>true</code> and <code>false</code>. The default is <code>true</code>.</p>
<h3 id="am.viewport" class="func-def">am.viewport(x, y, width, height)</h3>
<p>Set the viewport, which is the rectangular area of the window into which rendering will occur.</p>
<p><code>x</code> and <code>y</code> is the bottom-left corner of the viewport in pixels, where the bottom-left corner of the window is (0, 0). <code>width</code> and <code>height</code> are also in pixels.</p>
<p>Fields:</p>
<ul>
<li><code>x</code>, <code>y</code>, <code>width</code>, <code>height</code>: Updatable.</li>
</ul>
<p>Default tag: <code>&quot;viewport&quot;</code>.</p>
<h3 id="am.lookatuniform-eye-center-up" class="func-def">am.lookat([uniform,] eye, center, up)</h3>
<p>TODO</p>
<h3 id="am.cull_sphereuniforms...-radius-center" class="func-def">am.cull_sphere([uniforms...,] radius, center)</h3>
<p>TODO</p>
<h3 id="am.billboarduniform-preserve_scaling" class="func-def">am.billboard([uniform,] [preserve_scaling])</h3>
<p>TODO</p>
<h3 id="am.read_mat2uniform" class="func-def">am.read_mat2(uniform)</h3>
<p>TODO</p>
<h3 id="am.read_mat3uniform" class="func-def">am.read_mat3(uniform)</h3>
<p>TODO</p>
<h3 id="am.read_mat4uniform" class="func-def">am.read_mat4(uniform)</h3>
<p>TODO</p>
<h3 id="am.color_maskred-green-blue-alpha" class="func-def">am.color_mask(red, green, blue, alpha)</h3>
<p>TODO</p>
<h2 id="derived-scene-nodes">Derived scene nodes</h2>
<h3 id="am.text" class="func-def">am.text</h3>
<h3 id="am.sprite" class="func-def">am.sprite</h3>
<h3 id="am.rect" class="func-def">am.rect</h3>
<h3 id="am.circle" class="func-def">am.circle</h3>
<h3 id="am.particles2d" class="func-def">am.particles2d</h3>
<h3 id="am.postprocess" class="func-def">am.postprocess</h3>
<h2 id="creating-custom-scene-nodes">Creating custom scene nodes</h2>
<p>am.wrap</p>
<h1 id="graphics">Graphics</h1>
<h2 id="overview">Overview</h2>
<p>This section goes into detail about Amulets low-level graphics features. Some knowledge of how shaders and the modern graphics pipeline work is recommended before reading this section. If you're just interested in drawing simple sprites and shapes then you can probably skip this section, but if you're interested in experimenting with shaders and 3D rendering then read on.</p>
<h2 id="creating-a-window-1">Creating a window</h2>
<p>To create a window use the <code>am.window</code> function. This function accepts a table of window settings, all of which are optional. (For a full list of settings see am.window in the API reference.)</p>
<p>Here's how to create a 800x600 window:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> win <span class="ot">=</span> am<span class="ot">.</span>window<span class="ot">{</span>
    title <span class="ot">=</span> <span class="st">&quot;My Window&quot;</span><span class="ot">,</span>
    width <span class="ot">=</span> <span class="dv">800</span><span class="ot">,</span>
    height <span class="ot">=</span> <span class="dv">600</span><span class="ot">,</span>
<span class="ot">}</span></code></pre></div>
<p>The <code>width</code> and <code>height</code> settings are just hints to the operating system. It may create a bigger or smaller window.</p>
<p>Once a window is created you can obtain its actual pixel dimensions using the <code>width</code> and <code>height</code> fields of the window object. Don't assume these will be the same as the width and height you requested when creating the window.</p>
<p>Also don't expect these values to remain constant, even if you request a fullscreen window. On some platforms the operating system will perform an animation when transitioning to fullscreen mode and the width and height fields will only be updated once the animation has finished.</p>
<p>The window:resized method can be used to detect if a window's size changed since the last frame.</p>
<p>To close a window call its window:close method. This also quits the application if there was only one window open.</p>
<p>Note: while it's possible to create multiple windows, this isn't recommended at the moment.</p>
<h2 id="shaders">Shaders</h2>
<h2 id="scene-graphs-1">Scene graphs</h2>
<p>In Amulet, all drawing is done by building a <em>scene graph</em> that is then rendered to a window or offscreen framebuffer. Each node in the scene graph either configures some part of the graphics system (for example setting the blend mode or shader program), or draws some graphics primitives, such as triangles or lines.</p>
<p>Here is an example scene graph that draws a colored triangle:</p>
<p>This scene graph has 3 nodes:</p>
<ol style="list-style-type: decimal">
<li>The root node, <code>am.use_program</code>, sets up the shader program to use for subsequent rendering. Here we use the built-in shader program <code>am.shaders.colors2d</code> which is a simple shader that renders 2D vertices with a separate color per vertex.</li>
<li>The <code>am.bind</code> node binds values to the shader's uniforms and attributes -- it supplies data to the shader. The <code>am.shaders.colors2d</code> shader expects perspective and modelview matrix uniforms called <code>P</code> and <code>MV</code> respectively. We bind these to the identity matrices. It expects a vec4 attribute called <code>color</code> which we bind to an array of 3 colors (red, green and blue). The shader also expects a vec2 attribute called <code>vert</code>. We bind this to a vec2 array containing 3 vertices: (-1, -1), (1, -1) and (0, 1). Since we're using the identity perspective and modelview matrices these will correspond to the bottom left, bottom right and top middle points of the window we're drawing to.</li>
<li>Finally the <code>am.draw</code> node draws triangle primitives using the previously set up shader and data.</li>
</ol>
<p>The produced image looks like this:</p>
<div class="figure">
<img src="images/rgb_triangle.png" alt="" />

</div>
<p>And here's what the corresponding code looks like:</p>
<div class="sourceCode"><pre class="sourceCode lua"><code class="sourceCode lua">am<span class="ot">.</span>window<span class="ot">{}.</span>root <span class="ot">=</span>
    am<span class="ot">.</span>use_program<span class="ot">(</span>am<span class="ot">.</span>shaders<span class="ot">.</span>colors2d<span class="ot">)</span>
    <span class="ot">^</span> am<span class="ot">.</span>bind<span class="ot">{</span>
        P <span class="ot">=</span> mat4<span class="ot">(</span><span class="dv">1</span><span class="ot">),</span>
        MV <span class="ot">=</span> mat4<span class="ot">(</span><span class="dv">1</span><span class="ot">),</span>
        color <span class="ot">=</span> am<span class="ot">.</span>vec4_array<span class="ot">{</span>vec4<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span> vec4<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span> vec4<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">)},</span>
        vert <span class="ot">=</span> am<span class="ot">.</span>vec2_array<span class="ot">{</span>vec2<span class="ot">(-</span><span class="dv">1</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">1</span><span class="ot">),</span> vec2<span class="ot">(</span><span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">),</span> vec2<span class="ot">(</span><span class="dv">1</span><span class="ot">,</span> <span class="ot">-</span><span class="dv">1</span><span class="ot">)}</span>
    <span class="ot">}</span>
    <span class="ot">^</span> am<span class="ot">.</span>draw<span class="ot">(</span><span class="st">&quot;triangles&quot;</span><span class="ot">)</span></code></pre></div>
<h2 id="binding-shader-inputs">Binding shader inputs</h2>
<h2 id="drawing-primitives">Drawing primitives</h2>
<h2 id="transforms">Transforms</h2>
<h2 id="textures">Textures</h2>
<h2 id="framebuffers">Framebuffers</h2>
<h2 id="graphics-api-reference">Graphics API reference</h2>
<h1 id="actions-1">Actions</h1>
<h2 id="overview-1">Overview</h2>
<h2 id="creating-actions">Creating actions</h2>
<h2 id="cancelling-actions">Cancelling actions</h2>
<h2 id="composing-actions">Composing actions</h2>
<h1 id="input">Input</h1>
<h2 id="keyboard">Keyboard</h2>
<h2 id="mouse">Mouse</h2>
<h1 id="audio">Audio</h1>
<h2 id="audio-graphs">Audio graphs</h2>
<h2 id="playing-audio-1">Playing audio</h2>
<h2 id="analysing-audio">Analysing audio</h2>
<h2 id="audio-node-reference">Audio node reference</h2>
<h1 id="project-settings">Project settings</h1>
<h1 id="api-reference">API reference</h1>
<h2 id="maths-functions">Maths functions</h2>
<h3 id="vec2..." class="func-def">vec2(...)</h3>
<p>Constructs a 2 dimensional vector. See vec-cons for more details.</p>
<h3 id="vec3..." class="func-def">vec3(...)</h3>
<p>Constructs a 3 dimensional vector. See vec-cons for more details.</p>
<h3 id="vec4..." class="func-def">vec4(...)</h3>
<p>Constructs a 4 dimensional vector. See vec-cons for more details.</p>
<h3 id="math.dot-vector1-vector2" class="func-def">math.dot (vector1, vector2)</h3>
<p>Returns the dot product of two vectors. The vectors must have the same size.</p>
<h3 id="math.crossvector1-vector2" class="func-def">math.cross(vector1, vector2)</h3>
<p>Returns the cross product of two 3 dimensional vectors.</p>
<h3 id="math.normalizevector" class="func-def">math.normalize(vector)</h3>
<p>Returns the normalized form of a vector (i.e. the vector that points in the same direction, but whose length is 1). If the given vector has zero length, then a vector of the same size is returned whose first component is 1 and whose remaining components are 0.</p>
<h3 id="math.lengthvector" class="func-def">math.length(vector)</h3>
<p>Returns the length of a vector.</p>
<h3 id="math.distancevector1-vector2" class="func-def">math.distance(vector1, vector2)</h3>
<p>Returns the distance between two vectors.</p>
<h3 id="mat2..." class="func-def">mat2(...)</h3>
<p>Constructs a 2x2 matrix. See mat-cons for more details.</p>
<h3 id="mat3..." class="func-def">mat3(...)</h3>
<p>Constructs a 3x3 matrix. See mat-cons for more details.</p>
<h3 id="mat4..." class="func-def">mat4(...)</h3>
<p>Constructs a 4x4 matrix. See mat-cons for more details.</p>
<h3 id="math.inversematrix" class="func-def">math.inverse(matrix)</h3>
<p>Returns the inverse of a matrix.</p>
<h3 id="math.lookateye-center-up" class="func-def">math.lookat(eye, center, up)</h3>
<p>Creates a 4x4 view matrix at <code>eye</code>, looking in the direction of <code>center</code> with the y axis of the camera pointing in the direction same direction as <code>up</code>.</p>
<h3 id="math.perspectivefovy-aspect-near-far" class="func-def">math.perspective(fovy, aspect, near, far)</h3>
<p>Creates a 4x4 matrix for a symetric perspective-view frustum.</p>
<ul>
<li><code>fovy</code> is the field of view in the y plain, in radians.</li>
<li><code>aspect</code> is typically the window width divided by its height.</li>
<li><code>near</code> and <code>far</code> are the distances of the near and far clipping plains from the camera (these should be positive).</li>
</ul>
<h3 id="math.ortholeft-right-bottom-top-near-far" class="func-def">math.ortho(left, right, bottom, top [, near, far])</h3>
<p>Creates a 4x4 orthographic projection marix. The default values for <code>near</code> and <code>far</code> are <code>1</code> and <code>-1</code>.</p>
<h3 id="quat..." class="func-def">quat(...)</h3>
<p>Constructs a quaternion. See quat-cons for more details.</p>
<h3 id="math.perlinpos-period" class="func-def">math.perlin(pos [, period])</h3>
<p>Generate perlin noise. <code>pos</code> can be a 2, 3, or 4 dimensional vector, or a number. If the second argument is supplied then the noise will be periodic with the given period. <code>period</code> should be of the same type as <code>pos</code> and its components should be integers greater than 1.</p>
<p>The returned value is between -1 and 1.</p>
<h3 id="math.simplexpos" class="func-def">math.simplex(pos)</h3>
<p>Generate simplex noise. <code>pos</code> can be a 2, 3, or 4 dimensional vector, or a number.</p>
<p>The returned value is between -1 and 1.</p>
<h3 id="math.mixfrom-top-t" class="func-def">math.mix(from, top, t)</h3>
<p>Returns the linear interpolation between <code>from</code> and <code>to</code> determined by <code>t</code>. <code>from</code> and <code>to</code> can be numbers or vectors, and must be the same type. <code>t</code> should be a number between 0 and 1. <code>from</code> and <code>to</code> can also be quaternions. In that case <code>math.mix</code> returns the spherical linear interpolation of the two quaternions.</p>
<h2 id="window-functions">Window functions</h2>
<h3 id="window_func" class="func-def">am.window(settings)</h3>
<p>Creates a new window, returning a window object. <code>settings</code> is a table with any of the following fields:</p>
<ul>
<li><p><strong><code>mode</code></strong>: Either <code>&quot;windowed&quot;</code> or <code>&quot;fullscreen&quot;</code>. A fullscreen window will have the same resolution as the user's desktop. The default is <code>&quot;windowed&quot;</code>. Not all platforms support windowed mode (e.g. iOS). On these platforms this setting is ignored.</p></li>
<li><p><strong><code>width</code> and <code>height</code></strong>: The desired size of the window. This is not necessarily the size of the window in pixels (although it usually is if the window is created in <code>&quot;windowed&quot;</code> mode). Instead it defines the size of the window's <em>default coordinate system</em>. If letterboxing is enabled then this is (<code>-width/2</code>, <code>-height/2</code>) in the bottom-left corner and (<code>width/2</code>, <code>height/2</code>) in the top-right corner. If letterboxing is disabled, then the coordinate system will extend in the horizontal or vertical directions to ensure an area of at least <code>width</code><code>height</code> is visible in the center of the window. In either case the centre coordinate will always be (0, 0). The default size is 640480.</p></li>
<li><p><strong><code>title</code></strong>: The window title.</p></li>
<li><p><strong><code>resizable</code></strong>: Whether the window can be resized by the user (<code>true</code> or <code>false</code>, default <code>true</code>).</p></li>
<li><p><strong><code>borderless</code></strong>: Whether the window has a title bar and border (<code>true</code> or <code>false</code>, default <code>false</code>).</p></li>
<li><p><strong><code>depth_buffer</code></strong>: Whether the window has a depth buffer (<code>true</code> or <code>false</code>, default <code>false</code>).</p></li>
<li><p><strong><code>stencil_buffer</code></strong>: Whether the window has a stencil buffer (<code>true</code> or <code>false</code>, default <code>false</code>).</p></li>
<li><p><strong><code>lock_pointer</code></strong>: <code>true</code> or <code>false</code>. When pointer lock is enabled the cursor will be hidden and mouse movement will be set to &quot;relative&quot; mode. In this mode the mouse is tracked infinitely in all directions, i.e. as if there is no edge of the screen to stop the mouse cursor. This is useful for implementing first-person style mouse-look. The default is <code>false</code>.</p></li>
<li><p><strong><code>clear_color</code></strong>: The color (a <code>vec4</code>) used to clear the window each frame before drawing. The default clear color is black (<code>vec4(0, 0, 0, 1)</code>).</p></li>
<li><p><strong><code>letterbox</code></strong>: <code>true</code> or <code>false</code>. Indicates whether the original aspect ratio (as determined by the <code>width</code> and <code>height</code> settings of the window) should be maintained after a resize by adding black horizontal or vertical bars to the sides of the window. The default is <code>true</code>.</p></li>
<li><p><strong><code>msaa_samples</code></strong>: The number of samples to use for multisample anti-aliasing. This must be a power of 2. Use zero (the default) for no anti-aliasing.</p></li>
<li><p><strong><code>orientation</code></strong>: <code>&quot;portrait&quot;</code> or <code>&quot;landscape&quot;</code>. This specifies the supported orientation of the window on platforms that support orientation changes (e.g. iOS). If omitted, both orientations are supported.</p></li>
<li><p><strong><code>projection</code></strong>: A custom projection matrix (a <code>mat4</code>) to be used for the window's coordinate system. This matrix is used when transforming mouse or touch event coordinates and is set as the projection matrix for rendering, but does not affect the <code>left</code>, <code>right</code>, <code>top</code>, <code>bottom</code>, <code>width</code> and <code>height</code> fields of the window.</p></li>
</ul>
<h2 id="window-fields">Window fields</h2>
<h3 id="window.left" class="func-def">window.left</h3>
<p>The x coordinate of the left edge of the window in the window's default coordinate system.</p>
<p>Readonly.</p>
<h3 id="window.right" class="func-def">window.right</h3>
<p>The x coordinate of the right edge of the window, in the window's default coordinate system.</p>
<p>Readonly.</p>
<h3 id="window.bottom" class="func-def">window.bottom</h3>
<p>The y coordinate of the bottom edge of the window, in the window's default coordinate system.</p>
<p>Readonly.</p>
<h3 id="window.top" class="func-def">window.top</h3>
<p>The y coordinate of the top edge of the window, in the window's default coordinate system.</p>
<p>Readonly.</p>
<h3 id="window.width" class="func-def">window.width</h3>
<p>The width of the window in the window's default coordinate system. This will always be equal to the <code>width</code> setting supplied when the window was created if the <code>letterbox</code> setting is enabled. Otherwise it may be larger, but it will never be smaller than the <code>width</code> setting.</p>
<p>Readonly.</p>
<h3 id="window.height" class="func-def">window.height</h3>
<p>The height of the window in the window's default coordinate space. This will always be equal to the <code>height</code> setting supplied when the window was created if the <code>letterbox</code> setting is enabled. Otherwise it may be larger, but it will never be smaller than the <code>height</code> setting.</p>
<p>Readonly.</p>
<h3 id="window.pixel_width" class="func-def">window.pixel_width</h3>
<p>The real width of the window in pixels.</p>
<p>Readonly.</p>
<h3 id="window.pixel_height" class="func-def">window.pixel_height</h3>
<p>The real height of the window in pixels</p>
<p>Readonly.</p>
<h3 id="window.mode" class="func-def">window.mode</h3>
<p>See <a href="#window_func">window settings</a>.</p>
<p>Updatable.</p>
<h3 id="window.clear_color" class="func-def">window.clear_color</h3>
<p>See <a href="#window_func">window settings</a>.</p>
<p>Updatable.</p>
<h3 id="window.letterbox" class="func-def">window.letterbox</h3>
<p>See <a href="#window_func">window settings</a>.</p>
<p>Updatable.</p>
<h3 id="window.lock_pointer" class="func-def">window.lock_pointer</h3>
<p>See <a href="#window_func">window settings</a>.</p>
<p>Updatable.</p>
<h3 id="window.scene" class="func-def">window.scene</h3>
<p>The scene node currently attached to the window. This scene will be rendered to the window each frame.</p>
<p>Updatable.</p>
<h3 id="window.projection" class="func-def">window.projection</h3>
<p>See <a href="#window_func">window settings</a>.</p>
<p>Updatable.</p>
<h2 id="window-methods">Window methods</h2>
<h3 id="windowclose" class="func-def">window:close()</h3>
<p>Closes the window and quits the application if this was the only window.</p>
<h3 id="key_down" class="func-def">window:key_down(key)</h3>
<p>Returns true if the given key was down at the start of the current frame.</p>
<p>The possible values for <code>key</code> are:</p>
<ul>
<li><code>&quot;a&quot;</code></li>
<li><code>&quot;b&quot;</code></li>
<li><code>&quot;c&quot;</code></li>
<li><code>&quot;d&quot;</code></li>
<li><code>&quot;e&quot;</code></li>
<li><code>&quot;f&quot;</code></li>
<li><code>&quot;g&quot;</code></li>
<li><code>&quot;h&quot;</code></li>
<li><code>&quot;i&quot;</code></li>
<li><code>&quot;j&quot;</code></li>
<li><code>&quot;k&quot;</code></li>
<li><code>&quot;l&quot;</code></li>
<li><code>&quot;m&quot;</code></li>
<li><code>&quot;n&quot;</code></li>
<li><code>&quot;o&quot;</code></li>
<li><code>&quot;p&quot;</code></li>
<li><code>&quot;q&quot;</code></li>
<li><code>&quot;r&quot;</code></li>
<li><code>&quot;s&quot;</code></li>
<li><code>&quot;t&quot;</code></li>
<li><code>&quot;u&quot;</code></li>
<li><code>&quot;v&quot;</code></li>
<li><code>&quot;w&quot;</code></li>
<li><code>&quot;x&quot;</code></li>
<li><code>&quot;y&quot;</code></li>
<li><code>&quot;z&quot;</code></li>
<li><code>&quot;1&quot;</code></li>
<li><code>&quot;2&quot;</code></li>
<li><code>&quot;3&quot;</code></li>
<li><code>&quot;4&quot;</code></li>
<li><code>&quot;5&quot;</code></li>
<li><code>&quot;6&quot;</code></li>
<li><code>&quot;7&quot;</code></li>
<li><code>&quot;8&quot;</code></li>
<li><code>&quot;9&quot;</code></li>
<li><code>&quot;0&quot;</code></li>
<li><code>&quot;enter&quot;</code></li>
<li><code>&quot;escape&quot;</code></li>
<li><code>&quot;backspace&quot;</code></li>
<li><code>&quot;tab&quot;</code></li>
<li><code>&quot;space&quot;</code></li>
<li><code>&quot;minus&quot;</code></li>
<li><code>&quot;equals&quot;</code></li>
<li><code>&quot;leftbracket&quot;</code></li>
<li><code>&quot;rightbracket&quot;</code></li>
<li><code>&quot;backslash&quot;</code></li>
<li><code>&quot;semicolon&quot;</code></li>
<li><code>&quot;quote&quot;</code></li>
<li><code>&quot;backquote&quot;</code></li>
<li><code>&quot;comma&quot;</code></li>
<li><code>&quot;period&quot;</code></li>
<li><code>&quot;slash&quot;</code></li>
<li><code>&quot;capslock&quot;</code></li>
<li><code>&quot;f1&quot;</code></li>
<li><code>&quot;f2&quot;</code></li>
<li><code>&quot;f3&quot;</code></li>
<li><code>&quot;f4&quot;</code></li>
<li><code>&quot;f5&quot;</code></li>
<li><code>&quot;f6&quot;</code></li>
<li><code>&quot;f7&quot;</code></li>
<li><code>&quot;f8&quot;</code></li>
<li><code>&quot;f9&quot;</code></li>
<li><code>&quot;f10&quot;</code></li>
<li><code>&quot;f11&quot;</code></li>
<li><code>&quot;f12&quot;</code></li>
<li><code>&quot;printscreen&quot;</code></li>
<li><code>&quot;scrolllock&quot;</code></li>
<li><code>&quot;pause&quot;</code></li>
<li><code>&quot;insert&quot;</code></li>
<li><code>&quot;home&quot;</code></li>
<li><code>&quot;pageup&quot;</code></li>
<li><code>&quot;delete&quot;</code></li>
<li><code>&quot;end&quot;</code></li>
<li><code>&quot;pagedown&quot;</code></li>
<li><code>&quot;right&quot;</code></li>
<li><code>&quot;left&quot;</code></li>
<li><code>&quot;down&quot;</code></li>
<li><code>&quot;up&quot;</code></li>
<li><code>&quot;kp_divide&quot;</code></li>
<li><code>&quot;kp_multiply&quot;</code></li>
<li><code>&quot;kp_minus&quot;</code></li>
<li><code>&quot;kp_plus&quot;</code></li>
<li><code>&quot;kp_enter&quot;</code></li>
<li><code>&quot;kp_1&quot;</code></li>
<li><code>&quot;kp_2&quot;</code></li>
<li><code>&quot;kp_3&quot;</code></li>
<li><code>&quot;kp_4&quot;</code></li>
<li><code>&quot;kp_5&quot;</code></li>
<li><code>&quot;kp_6&quot;</code></li>
<li><code>&quot;kp_7&quot;</code></li>
<li><code>&quot;kp_8&quot;</code></li>
<li><code>&quot;kp_9&quot;</code></li>
<li><code>&quot;kp_0&quot;</code></li>
<li><code>&quot;kp_period&quot;</code></li>
<li><code>&quot;lctrl&quot;</code></li>
<li><code>&quot;lshift&quot;</code></li>
<li><code>&quot;lalt&quot;</code></li>
<li><code>&quot;lgui&quot;</code></li>
<li><code>&quot;rctrl&quot;</code></li>
<li><code>&quot;rshift&quot;</code></li>
<li><code>&quot;ralt&quot;</code></li>
<li><code>&quot;rgui&quot;</code></li>
</ul>
<h3 id="windowkeys_down" class="func-def">window:keys_down()</h3>
<p>Returns an array of the keys that were down at the start of the current frame. See <a href="#key_down">window:key_down</a> for a list of possible key values.</p>
<h3 id="windowkey_pressedkey" class="func-def">window:key_pressed(key)</h3>
<p>Returns true if the given key's state changed from up to down since the last frame. See <a href="#key_down">window:key_down</a> for possible values for <code>key</code>.</p>
<p>Note that if <code>key_pressed</code> returns true, then <code>key_down</code> will also return <code>true</code>. Also if <code>key_pressed</code> returns <code>true</code> then <code>key_released</code> will always return <code>false</code>. (If necessary, Amulet will postpone key release events to the next frame to ensure this.)</p>
<h3 id="windowkey_releasedkey" class="func-def">window:key_released(key)</h3>
<p>Returns true if the given key's state changed from down to up since the last frame. See <a href="#key_down">window:key_down</a> for possible values for <code>key</code>.</p>
<p>Note that if <code>key_released</code> returns true, then <code>key_down</code> will also return <code>false</code>. Also if <code>key_released</code> returns <code>true</code> then <code>key_pressed</code> will always return <code>false</code>. (If necessary, Amulet will postpone key press events to the next frame to ensure this.)</p>
<h3 id="windowmouse_position" class="func-def">window:mouse_position()</h3>
<p>Returns the position of the mouse cursor, as a <code>vec2</code>, in the window's coordinate system.</p>
<h3 id="windowmouse_norm_position" class="func-def">window:mouse_norm_position()</h3>
<p>Returns the position of the mouse cursor in normalized device coordinates, as a <code>vec2</code>.</p>
<h3 id="windowmouse_pixel_position" class="func-def">window:mouse_pixel_position()</h3>
<p>Returns the position of the mouse cursor in pixels where the bottom left corner of the window has coordinate (0, 0), as a <code>vec2</code>.</p>
<h3 id="windowmouse_delta" class="func-def">window:mouse_delta()</h3>
<p>Returns the change in mouse position since the last frame, in the window's coordinate system (a <code>vec2</code>).</p>
<h3 id="windowmouse_norm_delta" class="func-def">window:mouse_norm_delta()</h3>
<p>Returns the change in mouse position since the last frame, in normalized device coordinates (a <code>vec2</code>).</p>
<h3 id="windowmouse_pixel_delta" class="func-def">window:mouse_pixel_delta()</h3>
<p>Returns the change in mouse position since the last frame, in pixels (a <code>vec2</code>).</p>
<h3 id="windowmouse_downbutton" class="func-def">window:mouse_down(button)</h3>
<p>Returns <code>true</code> if the given button was down at the start of the frame. <code>button</code> may be <code>&quot;left&quot;</code>, <code>&quot;right&quot;</code> or <code>&quot;middle&quot;</code>.</p>
<h3 id="windowmouse_pressedbutton" class="func-def">window:mouse_pressed(button)</h3>
<p>Returns <code>true</code> if the given mouse button's state changed from up to down since the last frame. <code>button</code> may be <code>&quot;left&quot;</code>, <code>&quot;right&quot;</code> or <code>&quot;middle&quot;</code>.</p>
<p>Note that if <code>mouse_pressed</code> returns <code>true</code> then <code>mouse_down</code> will also return <code>true</code>. Also if <code>mouse_pressed</code> returns <code>true</code> then <code>mouse_released</code> will always return <code>false</code>. (If necessary, Amulet will postpone button release events to the next frame to ensure this.)</p>
<h3 id="windowmouse_releasedbutton" class="func-def">window:mouse_released(button)</h3>
<p>Returns true if the given mouse button's state changed from down to up since the last frame. <code>button</code> may be <code>&quot;left&quot;</code>, <code>&quot;right&quot;</code> or <code>&quot;middle&quot;</code>.</p>
<p>Note that if <code>mouse_released</code> returns <code>true</code> then <code>mouse_down</code> will also return <code>false</code>. Also if <code>mouse_released</code> returns <code>true</code> then <code>mouse_pressed</code> will always return <code>false</code>. (If necessary, Amulet will postpone button press events to the next frame to ensure this.)</p>
<h3 id="windowmouse_wheel" class="func-def">window:mouse_wheel()</h3>
<p>Returns the mouse scroll wheel position (a <code>vec2</code>).</p>
<h3 id="windowmouse_wheel_delta" class="func-def">window:mouse_wheel_delta()</h3>
<p>Returns the change in mouse scroll wheel position since the last frame (a <code>vec2</code>).</p>
<h3 id="touches_began" class="func-def">window:touches_began()</h3>
<p>Returns an array of the touches that began since the last frame.</p>
<p>Each touch is an integer and each time a new touch occurs the lowest available integer greater than or equal to 1 is assigned to the touch.</p>
<p>If there are no other active touches then the next touch will always be 1, so if your interface only expects a single touch at a time, you can just use 1 for all touch functions that take a touch argument and any additional touches will be ignored.</p>
<h3 id="windowtouches_ended" class="func-def">window:touches_ended()</h3>
<p>Returns an array of the touches that ended since the last frame.</p>
<h3 id="windowactive_touches" class="func-def">window:active_touches()</h3>
<p>Returns an array of the currently active touches.</p>
<h3 id="windowtouch_begantouch" class="func-def">window:touch_began(touch)</h3>
<p>Returns true if the specific touch began since the last frame.</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowtouch_endedtouch" class="func-def">window:touch_ended(touch)</h3>
<p>Returns true if the specific touch ended since the last frame.</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowtouch_positiontouch" class="func-def">window:touch_position(touch)</h3>
<p>Returns the last touch position in the window's coordinate system (a <code>vec2</code>).</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowtouch_norm_positiontouch" class="func-def">window:touch_norm_position(touch)</h3>
<p>Returns the last touch position in normalized device coordinates (a <code>vec2</code>).</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowtouch_pixel_positiontouch" class="func-def">window:touch_pixel_position(touch)</h3>
<p>Returns the last touch position in pixels, where the bottom left corner of the window is (0, 0) (a <code>vec2</code>).</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowtouch_deltatouch" class="func-def">window:touch_delta(touch)</h3>
<p>Returns the change in touch position since the last frame in the window's coordinate system (a <code>vec2</code>).</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowtouch_norm_deltatouch" class="func-def">window:touch_norm_delta(touch)</h3>
<p>Returns the change in touch position since the last frame in normalized device coordinates (a <code>vec2</code>).</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowtouch_pixel_deltatouch" class="func-def">window:touch_pixel_delta(touch)</h3>
<p>Returns the change in touch position since the last frame in pixels (a <code>vec2</code>).</p>
<p>See <a href="#touches_began"><code>window:touches_began</code></a> for additional notes on the <code>touch</code> argument.</p>
<h3 id="windowresized" class="func-def">window:resized()</h3>
<p>Returns true if the window's size changed since the last frame.</p>
</div>
</body>
</html>
